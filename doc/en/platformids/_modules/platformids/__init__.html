

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>platformids.__init__ &mdash; platformids  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1.37
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Shortcuts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">PlatformIDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_cockpit.html">apidoc</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_abstract.html">1. Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_platform_support.html">2. Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_blueprint.html">3. Blueprint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtplatformids_cli.html">4. Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../os_categorization.html">5. OS Categorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributions.html">6. Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_documents.html">7. Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_modules.html">8. Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_indices.html">9. Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_resources.html">10. Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">11. Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">12. External References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_part_license.html">13. Licenses</a></li>
</ul>
<p class="caption"><span class="caption-text">Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../howto/index.html">Howto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">platformids</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>platformids.__init__</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for platformids.__init__</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;The package &#39;platformids&#39; provides canonical enumerations of bit encoded numeric platform IDs</span>
<span class="sd">for the Python implementations CPython, IPython, IronPython, Jython, and PyPy.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#############################################</span>
<span class="c1">#</span>
<span class="c1"># See manuals for the detailed API.</span>
<span class="c1">#</span>
<span class="c1">#############################################</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="c1">#</span>
<span class="c1"># load Python syntax and implementation basics - requires support by &#39;pythonids.pythondist&#39;</span>
<span class="c1">#</span>
<span class="kn">from</span> <span class="nn">pythonids</span> <span class="k">import</span> <span class="n">PYV35Plus</span><span class="p">,</span><span class="n">ISSTR</span><span class="p">,</span> <span class="n">PYVxyz</span><span class="p">,</span> <span class="n">PYV33</span><span class="p">,</span> <span class="n">PYV2</span>
<span class="kn">from</span> <span class="nn">pythonids.pythondist</span> <span class="k">import</span> <span class="n">isJython</span><span class="p">,</span> <span class="n">ISINT</span><span class="p">,</span> <span class="n">PYDIST</span><span class="p">,</span> <span class="n">PYE_DIST</span><span class="p">,</span> <span class="n">PYE_JYTHON</span>
<span class="kn">from</span> <span class="nn">yapyutils.modules.loader</span> <span class="k">import</span> <span class="n">get_modulelocation</span><span class="p">,</span> <span class="n">load_module</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Artistic-License-2.0 + Forced-Fairplay-Constraints&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2010-2018 Arno-Can Uestuensoez&quot;</span> \
                <span class="s2">&quot; @Ingenieurbuero Arno-Can Uestuensoez&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.1.31&#39;</span>
<span class="n">__uuid__</span> <span class="o">=</span> <span class="s2">&quot;7add5ded-c39b-4b6e-8c87-1b3a1c150ee9&quot;</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s2">&quot;restructuredtext en&quot;</span>

<span class="c1"># central debug and verbose control of curretn package</span>
<span class="n">_debug</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">_verbose</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">#</span>
<span class="c1"># static pre-compiled scanner</span>
<span class="c1">#</span>

<span class="c1"># version conversion and normalization</span>
<span class="n">DSKORG_ID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(?s)ID=[&quot;</span><span class="se">\&#39;</span><span class="s1">]*([^&quot;</span><span class="se">\&#39;</span><span class="s1">\n\r]*).*&#39;</span><span class="p">)</span>
<span class="n">DSKORG_ID_LIKE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(?s)ID_LIKE=[&quot;</span><span class="se">\&#39;</span><span class="s1">]*([^&quot;</span><span class="se">\&#39;</span><span class="s1">\n\r]*).*&#39;</span><span class="p">)</span>
<span class="n">DSKORG_NAME_RELEASE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?s)^NAME=[&quot;</span><span class="se">\&#39;</span><span class="s1">]*([^ ]*) *([^&quot;</span><span class="se">\&#39;</span><span class="s1">]*).*&#39;</span><span class="p">)</span>
<span class="n">DSKORG_RELEASE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?s)^VERSION=[&quot;</span><span class="se">\&#39;</span><span class="s1">]*([^&quot;</span><span class="se">\&#39;</span><span class="s1">]*)[&quot;</span><span class="se">\&#39;</span><span class="s1">]*[^(]*[(]*([^)]*)[)]*.*&#39;</span><span class="p">)</span>
<span class="n">DSKORG_VERSION</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?s)^VERSION=[&quot;</span><span class="se">\&#39;</span><span class="s1">]*([^&quot;</span><span class="se">\&#39;</span><span class="s1">]*)[&quot;</span><span class="se">\&#39;</span><span class="s1">]*.*&#39;</span><span class="p">)</span>
<span class="n">PRENONNUM</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^0-9]+[^ \t0-9]).*&#39;</span><span class="p">)</span>
<span class="n">VERSION_ID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?s)^VERSION_ID=[&quot;</span><span class="se">\&#39;</span><span class="s1">]*([^&quot;</span><span class="se">\&#39;</span><span class="s1">]*)[&quot;</span><span class="se">\&#39;</span><span class="s1">]*.*&#39;</span><span class="p">)</span>
<span class="n">VERSNUM</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([0-9]+)[.]*([0-9]*)[.]*([0-9]*)&#39;</span><span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># shared exceptions</span>
<span class="c1">#</span>
<div class="viewcode-block" id="PlatformIDsError"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.PlatformIDsError">[docs]</a><span class="k">class</span> <span class="nc">PlatformIDsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Subsystem *PlatformIDs*.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PlatformIDsEnumerationError"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.PlatformIDsEnumerationError">[docs]</a><span class="k">class</span> <span class="nc">PlatformIDsEnumerationError</span><span class="p">(</span><span class="n">PlatformIDsError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enumeration of dynamic assigned values.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PlatformIDsUnknownError"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.PlatformIDsUnknownError">[docs]</a><span class="k">class</span> <span class="nc">PlatformIDsUnknownError</span><span class="p">(</span><span class="n">PlatformIDsError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unknown value.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PlatformIDsPresentError"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.PlatformIDsPresentError">[docs]</a><span class="k">class</span> <span class="nc">PlatformIDsPresentError</span><span class="p">(</span><span class="n">PlatformIDsError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Item already present, prohibited in strict mode.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PlatformIDsCustomError"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.PlatformIDsCustomError">[docs]</a><span class="k">class</span> <span class="nc">PlatformIDsCustomError</span><span class="p">(</span><span class="n">PlatformIDsError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;No more custom keys are available.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PlatformIDsKeyError"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.PlatformIDsKeyError">[docs]</a><span class="k">class</span> <span class="nc">PlatformIDsKeyError</span><span class="p">(</span><span class="n">PlatformIDsError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Key invalid.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="c1">#</span>
<span class="c1"># prepare  Jython vs. others - the most significant impact on available libraries</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">isJython</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">osname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c1"># e.g. CirctuiPython, MicroPython</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;requires special module&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">PYV35Plus</span><span class="p">:</span>
        <span class="n">PlatformIDsFileCheck</span> <span class="o">=</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,)</span>  <span class="c1"># @UndefinedVariable</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">PlatformIDsFileCheck</span> <span class="o">=</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">osname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">_name</span>  <span class="c1"># @UndefinedVariable  # set to the platform name</span>
    <span class="n">PlatformIDsFileCheck</span> <span class="o">=</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,)</span>  <span class="c1"># @UndefinedVariable</span>


<span class="n">RTE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">#: the numeric bitmask record</span>

<span class="c1">#</span>
<span class="c1"># current platform as bit-array with following bitmasks</span>
<span class="c1">#</span>
<span class="n">RTE_CATEGORY_B</span> <span class="o">=</span> <span class="mh">0xf0000000</span>  <span class="c1"># : bit: 31-28</span>
<span class="n">RTE_OSTYPE_B</span> <span class="o">=</span> <span class="mh">0x0f800000</span>  <span class="c1"># : bit: 27-23</span>
<span class="n">RTE_DIST_B</span> <span class="o">=</span> <span class="mh">0x007f0000</span>  <span class="c1"># : bit: 22-16</span>
<span class="n">RTE_DISTREL_B</span> <span class="o">=</span> <span class="mh">0x0000ffff</span>  <span class="c1"># : bit: 15-0</span>

<span class="n">RTE_CATEGORY_OFFSET</span> <span class="o">=</span> <span class="mh">0x0fffffff</span>  <span class="c1"># : bit: 28</span>
<span class="n">RTE_OSTYPE_OFFSET</span> <span class="o">=</span> <span class="mh">0x007fffff</span>  <span class="c1"># : bit: 23</span>
<span class="n">RTE_DIST_OFFSET</span> <span class="o">=</span> <span class="mh">0x0000ffff</span>  <span class="c1"># : bit: 16</span>
<span class="n">RTE_DISTREL_OFFSET</span> <span class="o">=</span> <span class="mh">0x00000000</span>  <span class="c1"># : bit: 0</span>

<span class="n">RTE_CATEGORY_SHIFT</span> <span class="o">=</span> <span class="mi">28</span>  <span class="c1"># : bit: 28</span>
<span class="n">RTE_OSTYPE_SHIFT</span> <span class="o">=</span> <span class="mi">23</span>  <span class="c1"># : bit: 23</span>
<span class="n">RTE_DIST_SHIFT</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># : bit: 16</span>
<span class="n">RTE_DISTREL_SHIFT</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># : bit: 0</span>

<span class="n">RTE_CATEGORY</span> <span class="o">=</span> <span class="mh">0xf0000000</span>  <span class="c1"># : bit: 31-28</span>
<span class="n">RTE_OSTYPE</span> <span class="o">=</span> <span class="mh">0xff800000</span>  <span class="c1"># : bit: 31-23</span>
<span class="n">RTE_DIST</span> <span class="o">=</span> <span class="mh">0xffff0000</span>  <span class="c1"># : bit: 31-16</span>
<span class="n">RTE_DISTREL</span> <span class="o">=</span> <span class="mh">0xffffffff</span>  <span class="c1"># : bit: 31-0</span>

<span class="c1">#</span>
<span class="c1"># Distribution with optional non-standard version scheme and optional callback</span>
<span class="c1"># the value is used as common offset for the *dist* defines</span>
<span class="c1">#</span>
<span class="n">RTE_DISTEXT</span> <span class="o">=</span> <span class="mh">0x00400000</span>  <span class="c1"># : bit: 22 flag for distribution schemes with optional callback</span>

<span class="c1">#</span>
<span class="c1"># category</span>
<span class="c1">#</span>
<span class="n">RTE_POSIX</span> <span class="o">=</span> <span class="mh">0x10000000</span>  <span class="c1"># : Posix systems using *fcntl* [POSIX]_.</span>
<span class="n">RTE_WIN32</span> <span class="o">=</span> <span class="mh">0x20000000</span>  <span class="c1"># : all Windows systems</span>
<span class="n">RTE_WIN</span> <span class="o">=</span> <span class="mh">0x20000000</span>  <span class="c1"># : all Windows systems</span>
<span class="n">RTE_WINDOWS</span> <span class="o">=</span> <span class="mh">0x20000000</span>  <span class="c1"># : all Windows systems</span>
<span class="n">RTE_EMU</span> <span class="o">=</span> <span class="mh">0x40000000</span>  <span class="c1"># : Logical Emulation Layer - Meta-Category providing a bit</span>
<span class="n">RTE_PWEMU</span> <span class="o">=</span> <span class="mh">0x70000000</span>  <span class="c1"># : Cygwin [CYGWIN]_ - special virtual environment</span>
<span class="n">RTE_WPEMU</span> <span class="o">=</span> <span class="mh">0x50000000</span>  <span class="c1"># : Windows emulation on Posix</span>
<span class="n">RTE_EMBEDDED</span> <span class="o">=</span> <span class="mh">0x80000000</span>  <span class="c1"># : Embedded OS/dist</span>


<span class="c1">#</span>
<span class="c1"># ostype</span>
<span class="c1">#</span>

<span class="c1"># context: RTE_WIN32</span>
<span class="n">RTE_NT</span> <span class="o">=</span> <span class="n">RTE_WIN32</span> <span class="o">+</span> <span class="mh">0x00800000</span>  <span class="c1"># : all Windows workstation systems</span>

<span class="n">RTE_CYGWINNT</span> <span class="o">=</span> <span class="n">RTE_PWEMU</span> <span class="o">+</span> <span class="mh">0x00800000</span>  <span class="c1"># : all Windows workstation systems - the &#39;os.uname&#39; is &#39;posix&#39;</span>

<span class="c1"># context: RTE_POSIX</span>
<span class="n">RTE_LINUX</span> <span class="o">=</span> <span class="n">RTE_POSIX</span> <span class="o">+</span> <span class="mh">0x00800000</span>  <span class="c1"># : all LINUX systems</span>
<span class="n">RTE_BSD</span> <span class="o">=</span> <span class="n">RTE_POSIX</span> <span class="o">+</span> <span class="mh">0x01000000</span>  <span class="c1"># : all BSD systems</span>
<span class="n">RTE_DARWIN</span> <span class="o">=</span> <span class="n">RTE_POSIX</span> <span class="o">+</span> <span class="mh">0x02000000</span>  <span class="c1"># : Darwin, as Posix OS/Core system</span>
<span class="n">RTE_UNIX</span> <span class="o">=</span> <span class="n">RTE_POSIX</span> <span class="o">+</span> <span class="mh">0x04000000</span>  <span class="c1"># : all UNIX systems</span>

<span class="c1">#</span>
<span class="c1"># dist</span>
<span class="c1">#</span>

<span class="c1"># context: RTE_POSIX.RTE_LINUX - standard distributions</span>
<span class="n">RTE_FEDORA</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00010000</span>  <span class="c1"># : Fedora</span>
<span class="n">RTE_CENTOS</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00020000</span>  <span class="c1"># : CentOS</span>
<span class="n">RTE_DEBIAN</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00030000</span>  <span class="c1"># : Debian</span>
<span class="n">RTE_RHEL</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00040000</span>  <span class="c1"># : RedHat Enterprise Linux</span>
<span class="n">RTE_SLES</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00050000</span>  <span class="c1"># : Suse Enterprise Linux</span>
<span class="n">RTE_UBUNTU</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00060000</span>  <span class="c1"># : Ubuntu</span>

<span class="n">RTE_OPENWRT</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00070000</span>  <span class="c1"># : OpenWRT</span>
<span class="n">RTE_RASPBIAN</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="mh">0x00080000</span>  <span class="c1"># : Raspbian</span>

<span class="c1">#</span>
<span class="c1"># *** rolling distributions ***</span>
<span class="c1">#</span>
<span class="n">RTE_KALI</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="n">RTE_DISTEXT</span> <span class="o">+</span> <span class="mh">0x00010000</span>  <span class="c1"># : Kali Linux - rolling dist</span>
<span class="n">RTE_ARCHLINUX</span> <span class="o">=</span> <span class="n">RTE_LINUX</span> <span class="o">+</span> <span class="n">RTE_DISTEXT</span> <span class="o">+</span> <span class="mh">0x00020000</span> <span class="c1">#: ArchLinux - rolling dist</span>

<span class="c1"># context: RTE_POSIX.RTE_UNIX</span>
<span class="n">RTE_SUNOS5</span> <span class="o">=</span> <span class="n">RTE_UNIX</span> <span class="o">+</span> <span class="mh">0x00020000</span>  <span class="c1"># : UNIX/SunOS5 is Solaris</span>
<span class="n">RTE_SOLARIS</span> <span class="o">=</span> <span class="n">RTE_SUNOS5</span>  <span class="c1"># : UNIX/SunOS5 is Solaris</span>

<span class="c1"># context: RTE_POSIX.RTE_DARWIN</span>
<span class="n">RTE_OSX</span> <span class="o">=</span> <span class="n">RTE_DARWIN</span> <span class="o">+</span> <span class="mh">0x00020000</span>  <span class="c1"># : Mac OS-X RTE_OSX is basically the short form of RTE_OSX10</span>
<span class="n">RTE_OSX10</span> <span class="o">=</span> <span class="n">RTE_OSX</span>  <span class="c1"># : Mac OS-X v10.x, as Posix system [POSIX]_, no macpath-legacy.</span>

<span class="c1"># context: RTE_POSIX.RTE_BSD</span>
<span class="n">RTE_OPENBSD</span> <span class="o">=</span> <span class="n">RTE_BSD</span> <span class="o">+</span> <span class="mh">0x00020000</span>  <span class="c1"># : OpenBSD</span>

<span class="c1">#</span>
<span class="c1"># category - perform basic platform identification</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="s1">&#39;posix&#39;</span> <span class="o">==</span> <span class="n">osname</span><span class="p">:</span>  <span class="c1"># unix, linux, bsd, osx</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CYGW&#39;</span><span class="p">):</span>
        <span class="c1"># Cygwin</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">RTE_PWEMU</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">RTE_POSIX</span>

    <span class="c1"># TODO&quot; RTE_WPEMU</span>

<span class="k">elif</span> <span class="s1">&#39;nt&#39;</span> <span class="o">==</span> <span class="n">osname</span><span class="p">:</span>  <span class="c1"># modern windows</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">RTE_WIN32</span>


<div class="viewcode-block" id="ProtectedDict"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDict">[docs]</a><span class="k">class</span> <span class="nc">ProtectedDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implements a &#39;dict&#39; with protection against modification of items. This is</span>
<span class="sd">    in order to protect a repository from erroneous modifications of it&#39;s </span>
<span class="sd">    entries by malicious code. The deletion is still supported, which is</span>
<span class="sd">    considered as intentional, thus done beeing aware of the consequences.  </span>
<span class="sd">    </span>
<span class="sd">    The main intention for the *platformids* is to avoid inconsistencies of</span>
<span class="sd">    hard-coded values of assigned enumerations by runtime redefinitions. </span>
<span class="sd">    Unintentional redefinitions also may proof as hard to debug.</span>
<span class="sd">    </span>
<span class="sd">    The member attribute *self.strict_check* controls how new items are added:</span>
<span class="sd">          </span>
<span class="sd">    0. single new item:</span>
<span class="sd">          add silently</span>
<span class="sd">    </span>
<span class="sd">    1. single item which is already present:</span>
<span class="sd">          * strict_check == True: raises exception</span>
<span class="sd">          * strict_check == False: ignores silently</span>
<span class="sd">    </span>
<span class="sd">    2. set of items, where none of the new set is present:</span>
<span class="sd">          add silently</span>
<span class="sd">    </span>
<span class="sd">    3. set of items, where at least one is present:</span>
<span class="sd">          * strict_check == True: raises exception</span>
<span class="sd">          * strict_check == False: add silently new, ignore present silently</span>
<span class="sd">    </span>
<span class="sd">     </span>
<span class="sd">    The common variables such as central dictionaries are thus read-only protected</span>
<span class="sd">    during the runtime of the process. The response style for the attempt to alter</span>
<span class="sd">    a value could be modified - raised to a stronger level - by the attribute</span>
<span class="sd">    &#39;strict_check&#39;, which raises an exception once set. </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ProtectedDict.__init__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDict.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;   </span>
<span class="sd">        Args:</span>
<span class="sd">            args:</span>
<span class="sd">            pass-through to dict</span>
<span class="sd">            </span>
<span class="sd">            kargs:</span>
<span class="sd">                non-defined are passed-through to dict</span>
<span class="sd">                </span>
<span class="sd">                int_keys_only:</span>
<span class="sd">                    Controls type of valid keys. ::</span>
<span class="sd">                    </span>
<span class="sd">                        int_keys_only := (</span>
<span class="sd">                            True    # permits interger keys only</span>
<span class="sd">                           | False  # permits any valid *dict* key</span>
<span class="sd">                        )</span>
<span class="sd">                </span>
<span class="sd">                strict_check:</span>
<span class="sd">                    Defines the handling of values for present keys. ::</span>
<span class="sd">                </span>
<span class="sd">                        True:   when True raises exception for present</span>
<span class="sd">                                items, </span>
<span class="sd">                        </span>
<span class="sd">                        False:  silently ignores new values for present</span>
<span class="sd">                                items</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Initialized object, or raises exception.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_check</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strict_check&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;strict_check&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">int_keys_only</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;int_keys_only&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;int_keys_only&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ProtectedDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;strict_check_reset&#39;</span><span class="p">,</span> <span class="s1">&#39;strict_check&#39;</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="n">PlatformIDsCustomError</span><span class="p">(</span><span class="s2">&quot;deletion not permitted for attribute: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="ProtectedDict.__setattr__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDict.__setattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filters and controls attribute values to be set.</span>
<span class="sd">   </span>
<span class="sd">        Args:</span>
<span class="sd">            name:</span>
<span class="sd">                Sets the attribute named by *name*. Establishes special</span>
<span class="sd">                handling for the in-band control attributes.</span>
<span class="sd">              </span>
<span class="sd">                    **strict_check**:</span>
<span class="sd">                        The value can only be raised to *True* in order to</span>
<span class="sd">                        strengthen the strictness.</span>
<span class="sd">                    </span>
<span class="sd">                    **strict_check_reset**:</span>
<span class="sd">                        If the value is set to *True*, than the member attribute</span>
<span class="sd">                        &#39;*strict_check*&#39; is set to *False*.</span>
<span class="sd">        </span>
<span class="sd">                Else calls &#39;*dict.__setattr__*&#39;. </span>
<span class="sd">        </span>
<span class="sd">            value:</span>
<span class="sd">                The value is passed through to *dict*, see also for special</span>
<span class="sd">                values of *name*.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Either filters defined control attributes - see *name*, or</span>
<span class="sd">            calls *dict.__setattr__*.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;strict_check_reset&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;strict_check&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;strict_check&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strict_check&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="c1"># initial value, this could later only be modified to the &#39;stronger&#39; True</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtectedDict.__setitem__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDict.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filter for already present mappings controlled by the</span>
<span class="sd">        member *strict_check*. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            name:</span>
<span class="sd">                Sets the item named by *name*. Controlled by</span>
<span class="sd">                the attribute *strict_check*. ::         </span>
<span class="sd">                  </span>
<span class="sd">                    self.strict_check := (</span>
<span class="sd">                         True   # permits only creation of non-present</span>
<span class="sd">                       | False  # normal behaviour</span>
<span class="sd">                    )</span>
<span class="sd">            </span>
<span class="sd">                Dependent on the presence raises an exception when</span>
<span class="sd">                strict is enabled.</span>
<span class="sd">            </span>
<span class="sd">            value:</span>
<span class="sd">                The value is passed through to *dict*, see also for special</span>
<span class="sd">                values of *name*.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict.__setitem__</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsPresentError</span>
<span class="sd">                Conditional based on *strict_check*, if *True* raises</span>
<span class="sd">                for present attributes *PlatformIDsPresentError*.</span>
<span class="sd">              </span>
<span class="sd">            PlatformIDsKeyError</span>
<span class="sd">                For non-int keys when *int_keys_only* is set.</span>
<span class="sd">        </span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_check</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PlatformIDsPresentError</span><span class="p">(</span><span class="s2">&quot;key-present: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_keys_only</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PlatformIDsKeyError</span><span class="p">(</span><span class="s2">&quot;Integer keys only: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtectedDict.update"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a set of items, filters each for presence.</span>

<span class="sd">        * none of the new set is present: </span>
<span class="sd">            adds all silently</span>
<span class="sd">                 </span>
<span class="sd">        * at least one is present:</span>
<span class="sd">            * strict_check == True: raises exception</span>
<span class="sd">            * strict_check == False: add silently</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">        </span>
<span class="sd">            dict2:</span>
<span class="sd">                Adds items controlled by the attribute *strict_check*. ::         </span>
<span class="sd">                 </span>
<span class="sd">                    self.strict_check := (</span>
<span class="sd">                         True   # permits only creation of non-present</span>
<span class="sd">                       | False  # normal behaviour</span>
<span class="sd">                    )</span>
<span class="sd">        </span>
<span class="sd">                Dependent on the presence of at least one raises an </span>
<span class="sd">                exception when strict is enabled.</span>
<span class="sd">        </span>
<span class="sd">            args:</span>
<span class="sd">                Passed to *dict.update*.</span>
<span class="sd">              </span>
<span class="sd">            kargs:</span>
<span class="sd">                Passed to *dict.update*.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict.update or None</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsPresentError</span>
<span class="sd">                Conditional based on *strict_check*, if *True* raises</span>
<span class="sd">                for present attributes *PlatformIDsPresentError*.</span>
<span class="sd">        </span>
<span class="sd">            PlatformIDsKeyError</span>
<span class="sd">                For non-int keys when *int_keys_only* is set.</span>
<span class="sd">        </span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># should not be called frequently, thus ok.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_keys_only</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">isJython</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">long</span><span class="p">:</span>  <span class="c1"># @UndefinedVariable</span>
                                <span class="k">raise</span> <span class="n">PlatformIDsKeyError</span><span class="p">(</span><span class="s2">&quot;Numeric keys only: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">PlatformIDsKeyError</span><span class="p">(</span><span class="s2">&quot;Numeric keys only: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># has keys already present</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_check</span><span class="p">:</span>
                <span class="c1"># strict is enabled</span>
                <span class="n">_str</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># get list of present keys</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                        <span class="n">_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

                <span class="c1"># notify with complete list</span>
                <span class="k">raise</span> <span class="n">PlatformIDsPresentError</span><span class="p">(</span>
                    <span class="s2">&quot;keys-present:</span><span class="se">\n</span><span class="s2">  </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_str</span><span class="p">))))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># not in strict mode, thus normal procedure</span>

                <span class="n">common</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dict2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">common</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># normal procedure</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ProtectedDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ProtectedDictEnum"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum">[docs]</a><span class="k">class</span> <span class="nc">ProtectedDictEnum</span><span class="p">(</span><span class="n">ProtectedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implements the dynamic creation and management of numeric enumeration</span>
<span class="sd">    values. These are used as dynamic assigned constants with the life time</span>
<span class="sd">    of the process itself. The enums are optimized to be used in conjunction</span>
<span class="sd">    with numeric bitmask vectors.</span>
<span class="sd">    The values are created on-demand, e.g. for dynamic loaded packages, and</span>
<span class="sd">    could be removed when no longer required. Thus are released than for the </span>
<span class="sd">    reuse.</span>
<span class="sd">    </span>
<span class="sd">    The management of the unused numeric values for assignment is performed</span>
<span class="sd">    by two levels. </span>
<span class="sd">    </span>
<span class="sd">    0. The value is managed by a protected counter within the defined range.</span>
<span class="sd">    1. Once the values are exhausted, the dictionary is used as release map.</span>
<span class="sd">       This is required due to the possible storage of the values by the</span>
<span class="sd">       application, thus assigned values cannot be reassigned and though</span>
<span class="sd">       the ranges could become used sparse. </span>
<span class="sd">          </span>
<span class="sd">       This level is much slower, though it is based on the lookup and remove</span>
<span class="sd">       form the unused-map.</span>
<span class="sd">       And of course, previous releases has to be present |smilecool|.</span>
<span class="sd">    </span>
<span class="sd">    Anyhow, e.g. in case of *platformids* for the *ostype*</span>
<span class="sd">    and *dist* the ranges for the additional dynamic assigments in are </span>
<span class="sd">    about 100 for the distribution *dist*, about 25 for the OS </span>
<span class="sd">    type *ostype*, and about 12 for the category *category*. This should be </span>
<span class="sd">    in practical realworld use-cases more than sufficient.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    REMARK: Implemented as *dict* for coming extensions. </span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ProtectedDictEnum.__init__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes key reservation.</span>
<span class="sd">        The custom range values has to comply to the bitmask segments.</span>
<span class="sd">        These define the minimal and maximal values in accordance to the common ranges </span>
<span class="sd">        by the mathematical notation:</span>
<span class="sd">        </span>
<span class="sd">        .. parsed-literal::</span>
<span class="sd">        </span>
<span class="sd">           values := [custom_min, custom_max)   # excluding custom_max</span>
<span class="sd">        </span>
<span class="sd">        The values could be processed by the application of the helper constants,</span>
<span class="sd">        see :ref:`Helper Constants &lt;BITMASK_HELPERCONSTS&gt;`.   </span>
<span class="sd">        E.g. in case of *dist* for the *ostype* context of *RTE_LINUX* :</span>
<span class="sd">        </span>
<span class="sd">        .. parsed-literal::</span>
<span class="sd">        </span>
<span class="sd">           custom_min == ((RTE_LINUX + RTE_DISTEXT + RTE_DIST_OFFSET +   0) &amp; RTE_DIST_B) </span>
<span class="sd">           custom_max == ((RTE_LINUX + RTE_DISTEXT + RTE_DIST_OFFSET + 126) &amp; RTE_DIST_B) </span>
<span class="sd">        </span>
<span class="sd">        or</span>
<span class="sd">        </span>
<span class="sd">        .. parsed-literal::</span>
<span class="sd">        </span>
<span class="sd">           (custom_min &gt;&gt; 16) == 0 </span>
<span class="sd">           (custom_max &gt;&gt; 16) == 126 </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        The caller is responsible for the appropriate values.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            kargs:</span>
<span class="sd">                default pass-through to dict</span>
<span class="sd">                </span>
<span class="sd">                custom_max:</span>
<span class="sd">                    Defines the maximum of custom range.</span>
<span class="sd">                    When missing no custom range os available.</span>
<span class="sd">                    </span>
<span class="sd">                    .. parsed-literal::</span>
<span class="sd">                    </span>
<span class="sd">                       custom_max &gt; custom_min</span>
<span class="sd">                    </span>
<span class="sd">                    default := None</span>
<span class="sd">                </span>
<span class="sd">                custom_min:</span>
<span class="sd">                    Defines the minimum of custom range.</span>
<span class="sd">                    When missing no custom range os available.</span>
<span class="sd">                    </span>
<span class="sd">                    default := None</span>
<span class="sd">                </span>
<span class="sd">                custom_offset:</span>
<span class="sd">                    Defines the offset for the increment and decrement.</span>
<span class="sd">                    This is required e.g. in case of bitmask fields</span>
<span class="sd">                    with segments starts at bits greater than 0.</span>
<span class="sd">                    </span>
<span class="sd">                    default := 0</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Initialized object, or raises exception.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsEnumerationError</span>
<span class="sd">                Erroneous custom range is provided.</span>
<span class="sd">               </span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;custom_offset&#39;</span><span class="p">,</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;custom_offset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># drop for parent __init__</span>
            <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;custom_offset&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># : the last permitted reservation</span>
        <span class="n">_cm</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;custom_max&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;custom_max&#39;</span><span class="p">,</span> <span class="n">_cm</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># drop for parent __init__</span>
            <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;custom_max&#39;</span><span class="p">)</span>

            <span class="c1"># the current</span>
            <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="n">_cm</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># the current</span>
            <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="n">_cm</span><span class="p">)</span>

        <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;custom_min&#39;</span><span class="p">,</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;custom_min&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># drop for parent __init__</span>
            <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;custom_min&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_min</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_max</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_min</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_max</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_min</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PlatformIDsEnumerationError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid custom range min = </span><span class="si">%s</span><span class="s2"> - max = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_min</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_max</span><span class="p">))</span>
                <span class="p">)</span>

        <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;int_keys_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ProtectedDictEnum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        
        <span class="c1"># deleted non-continous entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.__delitem__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.__delitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prohibits unmanaged access to the enum pool, use method *delete_enum* instead for</span>
<span class="sd">        managed release.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            enum:</span>
<span class="sd">                Enum key.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Raises exception.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsCustomError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">PlatformIDsCustomError</span><span class="p">(</span><span class="s2">&quot;prohibits unmanaged access, use method delete_enum&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.__delattr__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.__delattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Protects the enumeration management attributes from deletion.</span>

<span class="sd">        Args:</span>
<span class="sd">            name:</span>
<span class="sd">                Excludes reserved attributes from deletion. ::</span>
<span class="sd">        </span>
<span class="sd">                    name :=(</span>
<span class="sd">                         &#39;reserved&#39;</span>
<span class="sd">                       | &#39;custom_min&#39;</span>
<span class="sd">                       | &#39;custom_max&#39;</span>
<span class="sd">                    )</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsEnumerationError</span>
<span class="sd">           </span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="s1">&#39;custom_min&#39;</span><span class="p">,</span> <span class="s1">&#39;custom_max&#39;</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="n">PlatformIDsEnumerationError</span><span class="p">(</span><span class="s2">&quot;attribute cannot be deleted: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.__setattr__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.__setattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Protects the enumeration management attributes from non-managed </span>
<span class="sd">        direct access.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            name:</span>
<span class="sd">                Excludes reserved attributes from direct access. ::</span>
<span class="sd">        </span>
<span class="sd">                    name :=(</span>
<span class="sd">                         &#39;reserved&#39;</span>
<span class="sd">                       | &#39;custom_min&#39;</span>
<span class="sd">                       | &#39;custom_max&#39;</span>
<span class="sd">                    )</span>
<span class="sd">        </span>
<span class="sd">            value:</span>
<span class="sd">                Value to be set.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsEnumerationError</span>
<span class="sd">           </span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="s1">&#39;custom_min&#39;</span><span class="p">,</span> <span class="s1">&#39;custom_max&#39;</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="n">PlatformIDsEnumerationError</span><span class="p">(</span><span class="s2">&quot;attribute cannot be set direct: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.__setitem__"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enum</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prohibits unmanaged access to the enum pool, use method *add_enum* instead for</span>
<span class="sd">        managed release.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            enum:</span>
<span class="sd">                Enum key.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Raises exception.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsCustomError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">PlatformIDsCustomError</span><span class="p">(</span><span class="s2">&quot;prohibits unmanaged access, use method add_enum&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.add_enum"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.add_enum">[docs]</a>    <span class="k">def</span> <span class="nf">add_enum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reserves and assigns the next free unique key to the</span>
<span class="sd">        value. The assigned key value is returned for use. </span>
<span class="sd">        Custom ranges are available when the values *custom_max*</span>
<span class="sd">        and *custom_min* are initialized appropriately.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Either returns the reserved key, or raises exception when range is exhausted.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsCustomError:</span>
<span class="sd">                No custom ranges are configured.</span>
<span class="sd">            </span>
<span class="sd">            PlatformIDsEnumerationError</span>
<span class="sd">                The configured range is exhausted.</span>
<span class="sd">            </span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">:</span>
            <span class="c1"># reuse released first</span>
            
            <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
            <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">:</span>  <span class="c1"># 0 is non active</span>
                <span class="k">raise</span> <span class="n">PlatformIDsCustomError</span><span class="p">(</span>
                    <span class="s2">&quot;No custom ranges are available&quot;</span>
                    <span class="p">)</span>
    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_min</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PlatformIDsEnumerationError</span><span class="p">(</span>
                    <span class="s2">&quot;custom range exhausted&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># get next key</span>
            <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_offset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    
            <span class="c1"># add value</span>
            <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        
            <span class="c1"># return key for use</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.check_next_free_enum"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.check_next_free_enum">[docs]</a>    <span class="k">def</span> <span class="nf">check_next_free_enum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks and returns the next free value.</span>
<span class="sd">   </span>
<span class="sd">        **Does not reserve, just displays next.**</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">           None</span>
<span class="sd">           </span>
<span class="sd">        Returns:</span>
<span class="sd">           Value to be used by next call of *add_enum*.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">           PlatformIDsCustomError:</span>
<span class="sd">              No custom ranges are configured.</span>
<span class="sd">        </span>
<span class="sd">           PlatformIDsEnumerationError</span>
<span class="sd">              Range exhausted, no free values are available.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">:</span>  <span class="c1"># 0 is non active</span>
            <span class="k">raise</span> <span class="n">PlatformIDsCustomError</span><span class="p">(</span>
                <span class="s2">&quot;No custom ranges are available&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_min</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span>  <span class="c1"># - self.custom_offset - 1</span>

        <span class="k">raise</span> <span class="n">PlatformIDsEnumerationError</span><span class="p">(</span>
            <span class="s2">&quot;Reserved range exhausted.&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.purge"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.purge">[docs]</a>    <span class="k">def</span> <span class="nf">purge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears the list of deleted non-continous enums.</span>
<span class="sd">        Deletes all entries in the release map, which could be added</span>
<span class="sd">        incremental and continous to the reserved-list of vallues</span>
<span class="sd">        beginning at from *custom_min*. </span>
<span class="sd">        This re-initializes for the purged items the pure numeric first level </span>
<span class="sd">        assignement by ranges - spares for these the lookup in the non-continous</span>
<span class="sd">        list.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            kargs:</span>
<span class="sd">                maxrel:</span>
<span class="sd">                    Maximum to be released.</span>
<span class="sd">        </span>
<span class="sd">                minrel:</span>
<span class="sd">                    Minimum to be released.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Returns the number of actual releases.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsEnumerationError:</span>
<span class="sd">                Could not fulfil *minrel*.</span>
<span class="sd">        </span>
<span class="sd">            pass-through   </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">minrel</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minrel&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">maxrel</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxrel&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">))</span>
        
        <span class="n">relcnt</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">enum</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">enum</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">:</span>
                <span class="c1"># continous optimization at low-cost</span>
                <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="n">enum</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">enum</span><span class="p">)</span>
                <span class="n">relcnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">maxrel</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">maxrel</span><span class="p">:</span>
                    <span class="k">break</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># needs continous ranges beginning at self.custom_min / self.reserved</span>
                <span class="k">break</span>
        
        <span class="k">if</span> <span class="n">minrel</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">relcnt</span> <span class="o">&lt;</span> <span class="n">minrel</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PlatformIDsEnumerationError</span><span class="p">(</span>
                    <span class="s2">&quot;Could not release requested range: req = </span><span class="si">%d</span><span class="s2"> / done = </span><span class="si">%d</span><span class="s2"> / free = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">minrel</span><span class="p">,</span>
                        <span class="n">relcnt</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_min</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">relcnt</span></div>

<div class="viewcode-block" id="ProtectedDictEnum.delete_enum"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.delete_enum">[docs]</a>    <span class="k">def</span> <span class="nf">delete_enum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Releases a given enum, either continous values by changing the reserved values,</span>
<span class="sd">        or by adding a non-continous values to the dict of released items.</span>
<span class="sd">        The non-continous released items could be cleared by the method *purge*.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            enum:</span>
<span class="sd">                Enum key.</span>
<span class="sd">              </span>
<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">enum</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">:</span>
            <span class="c1"># continous optimization at low-cost</span>
            <span class="n">ProtectedDict</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="n">enum</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">enum</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">[</span><span class="n">enum</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">enum</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span> </div>

<div class="viewcode-block" id="ProtectedDictEnum.update"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.ProtectedDictEnum.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prohibits updates.</span>
<span class="sd">        This is required in order to avoid arbitrary updates which simply</span>
<span class="sd">        would complicate the management and assignment of further values.</span>
<span class="sd">        Thus only individual values could be added and removed. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Raises Exception.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            PlatformIDsEnumerationError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">PlatformIDsCustomError</span><span class="p">(</span><span class="s2">&quot;operation not permitted: update&quot;</span><span class="p">)</span></div></div>


<span class="c1"># : mapping of the rte string and numeric representation to the numeric value</span>
<span class="n">rte2num</span> <span class="o">=</span> <span class="n">ProtectedDict</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;bsd&#39;</span><span class="p">:</span> <span class="n">RTE_BSD</span><span class="p">,</span>
        <span class="s1">&#39;darwin&#39;</span><span class="p">:</span> <span class="n">RTE_DARWIN</span><span class="p">,</span>
        <span class="s1">&#39;emu&#39;</span><span class="p">:</span> <span class="n">RTE_EMU</span><span class="p">,</span>
        <span class="s1">&#39;linux&#39;</span><span class="p">:</span> <span class="n">RTE_LINUX</span><span class="p">,</span>
        <span class="s1">&#39;linux2&#39;</span><span class="p">:</span> <span class="n">RTE_LINUX</span><span class="p">,</span>
        <span class="s1">&#39;nt&#39;</span><span class="p">:</span> <span class="n">RTE_NT</span><span class="p">,</span>
        <span class="s1">&#39;wpemu&#39;</span><span class="p">:</span> <span class="n">RTE_WPEMU</span><span class="p">,</span>
        <span class="s1">&#39;posix&#39;</span><span class="p">:</span> <span class="n">RTE_POSIX</span><span class="p">,</span>
        <span class="s1">&#39;pwemu&#39;</span><span class="p">:</span> <span class="n">RTE_PWEMU</span><span class="p">,</span>
        <span class="s1">&#39;unix&#39;</span><span class="p">:</span> <span class="n">RTE_UNIX</span><span class="p">,</span>
        <span class="s1">&#39;win&#39;</span><span class="p">:</span> <span class="n">RTE_WIN32</span><span class="p">,</span>
        <span class="s1">&#39;win32&#39;</span><span class="p">:</span> <span class="n">RTE_WIN32</span><span class="p">,</span>
        <span class="s1">&#39;windows&#39;</span><span class="p">:</span> <span class="n">RTE_WINDOWS</span><span class="p">,</span>
        <span class="n">RTE_BSD</span><span class="p">:</span> <span class="n">RTE_BSD</span><span class="p">,</span>
        <span class="n">RTE_DARWIN</span><span class="p">:</span> <span class="n">RTE_DARWIN</span><span class="p">,</span>
        <span class="n">RTE_EMU</span><span class="p">:</span> <span class="n">RTE_EMU</span><span class="p">,</span>
        <span class="n">RTE_LINUX</span><span class="p">:</span> <span class="n">RTE_LINUX</span><span class="p">,</span>
        <span class="n">RTE_NT</span><span class="p">:</span> <span class="n">RTE_NT</span><span class="p">,</span>
        <span class="n">RTE_WPEMU</span><span class="p">:</span> <span class="n">RTE_WPEMU</span><span class="p">,</span>
        <span class="n">RTE_POSIX</span><span class="p">:</span> <span class="n">RTE_POSIX</span><span class="p">,</span>
        <span class="n">RTE_PWEMU</span><span class="p">:</span> <span class="n">RTE_PWEMU</span><span class="p">,</span>
        <span class="n">RTE_WIN32</span><span class="p">:</span> <span class="n">RTE_WIN32</span><span class="p">,</span>
        <span class="n">RTE_WINDOWS</span><span class="p">:</span> <span class="n">RTE_WINDOWS</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="c1"># frequent used current subsets</span>
        <span class="c1">#</span>
        <span class="s1">&#39;SunOS5&#39;</span><span class="p">:</span> <span class="n">RTE_SOLARIS</span><span class="p">,</span>
        <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">RTE_ARCHLINUX</span><span class="p">,</span>
        <span class="s1">&#39;archlinux&#39;</span><span class="p">:</span> <span class="n">RTE_ARCHLINUX</span><span class="p">,</span>
        <span class="s1">&#39;centos&#39;</span><span class="p">:</span> <span class="n">RTE_CENTOS</span><span class="p">,</span>
        <span class="s1">&#39;debian&#39;</span><span class="p">:</span> <span class="n">RTE_DEBIAN</span><span class="p">,</span>
        <span class="s1">&#39;fedora&#39;</span><span class="p">:</span> <span class="n">RTE_FEDORA</span><span class="p">,</span>
        <span class="s1">&#39;openbsd&#39;</span><span class="p">:</span> <span class="n">RTE_OPENBSD</span><span class="p">,</span>
        <span class="s1">&#39;openwrt&#39;</span><span class="p">:</span> <span class="n">RTE_OPENWRT</span><span class="p">,</span>
        <span class="s1">&#39;osx&#39;</span><span class="p">:</span> <span class="n">RTE_OSX</span><span class="p">,</span>
        <span class="s1">&#39;osx10&#39;</span><span class="p">:</span> <span class="n">RTE_OSX10</span><span class="p">,</span>
        <span class="s1">&#39;raspbian&#39;</span><span class="p">:</span> <span class="n">RTE_RASPBIAN</span><span class="p">,</span>
        <span class="s1">&#39;rhel&#39;</span><span class="p">:</span> <span class="n">RTE_RHEL</span><span class="p">,</span>
        <span class="s1">&#39;solaris&#39;</span><span class="p">:</span> <span class="n">RTE_SOLARIS</span><span class="p">,</span>
        <span class="n">RTE_ARCHLINUX</span><span class="p">:</span> <span class="n">RTE_ARCHLINUX</span><span class="p">,</span>
        <span class="n">RTE_CENTOS</span><span class="p">:</span> <span class="n">RTE_CENTOS</span><span class="p">,</span>
        <span class="n">RTE_DEBIAN</span><span class="p">:</span> <span class="n">RTE_DEBIAN</span><span class="p">,</span>
        <span class="n">RTE_FEDORA</span><span class="p">:</span> <span class="n">RTE_FEDORA</span><span class="p">,</span>
        <span class="n">RTE_OPENBSD</span><span class="p">:</span> <span class="n">RTE_OPENBSD</span><span class="p">,</span>
        <span class="n">RTE_OPENWRT</span><span class="p">:</span> <span class="n">RTE_OPENWRT</span><span class="p">,</span>
        <span class="n">RTE_OSX10</span><span class="p">:</span> <span class="n">RTE_OSX10</span><span class="p">,</span>
        <span class="n">RTE_OSX</span><span class="p">:</span> <span class="n">RTE_OSX</span><span class="p">,</span>
        <span class="n">RTE_RASPBIAN</span><span class="p">:</span> <span class="n">RTE_RASPBIAN</span><span class="p">,</span>
        <span class="n">RTE_RHEL</span><span class="p">:</span> <span class="n">RTE_RHEL</span><span class="p">,</span>
        <span class="n">RTE_SOLARIS</span><span class="p">:</span> <span class="n">RTE_SOLARIS</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># : mapping of the rte numeric representation to the string value</span>
<span class="c1"># num2rte = {</span>
<span class="n">num2rte</span> <span class="o">=</span> <span class="n">ProtectedDict</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">RTE_ARCHLINUX</span><span class="p">:</span> <span class="s1">&#39;archlinux&#39;</span><span class="p">,</span>
        <span class="n">RTE_BSD</span><span class="p">:</span> <span class="s1">&#39;bsd&#39;</span><span class="p">,</span>
        <span class="n">RTE_CENTOS</span><span class="p">:</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span>
        <span class="n">RTE_DARWIN</span><span class="p">:</span> <span class="s1">&#39;darwin&#39;</span><span class="p">,</span>
        <span class="n">RTE_DEBIAN</span><span class="p">:</span> <span class="s1">&#39;debian&#39;</span><span class="p">,</span>
        <span class="n">RTE_EMU</span><span class="p">:</span> <span class="s1">&#39;emu&#39;</span><span class="p">,</span>
        <span class="n">RTE_FEDORA</span><span class="p">:</span> <span class="s1">&#39;fedora&#39;</span><span class="p">,</span>
        <span class="n">RTE_LINUX</span><span class="p">:</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span>
        <span class="n">RTE_NT</span><span class="p">:</span> <span class="s1">&#39;nt&#39;</span><span class="p">,</span>
        <span class="n">RTE_OPENBSD</span><span class="p">:</span> <span class="s1">&#39;openbsd&#39;</span><span class="p">,</span>
        <span class="n">RTE_OPENBSD</span><span class="p">:</span> <span class="s1">&#39;openbsd&#39;</span><span class="p">,</span>
        <span class="n">RTE_OPENWRT</span><span class="p">:</span> <span class="s1">&#39;openwrt&#39;</span><span class="p">,</span>
        <span class="n">RTE_OSX10</span><span class="p">:</span> <span class="s1">&#39;osx10&#39;</span><span class="p">,</span>
        <span class="n">RTE_WPEMU</span><span class="p">:</span> <span class="s1">&#39;wpemu&#39;</span><span class="p">,</span>
        <span class="n">RTE_POSIX</span><span class="p">:</span> <span class="s1">&#39;posix&#39;</span><span class="p">,</span>
        <span class="n">RTE_PWEMU</span><span class="p">:</span> <span class="s1">&#39;pwemu&#39;</span><span class="p">,</span>
        <span class="n">RTE_RASPBIAN</span><span class="p">:</span> <span class="s1">&#39;raspbian&#39;</span><span class="p">,</span>
        <span class="n">RTE_RHEL</span><span class="p">:</span> <span class="s1">&#39;rhel&#39;</span><span class="p">,</span>
        <span class="n">RTE_SOLARIS</span><span class="p">:</span> <span class="s1">&#39;solaris&#39;</span><span class="p">,</span>
        <span class="n">RTE_UNIX</span><span class="p">:</span> <span class="s1">&#39;unix&#39;</span><span class="p">,</span>
        <span class="n">RTE_WIN32</span><span class="p">:</span> <span class="s1">&#39;win32&#39;</span><span class="p">,</span>
        <span class="n">RTE_WINDOWS</span><span class="p">:</span> <span class="s1">&#39;windows&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># : For UI of command line tools, load on demand by update()</span>
<span class="c1"># : see platformids.map_enum_labels</span>
<span class="n">num2enumstr</span> <span class="o">=</span> <span class="n">ProtectedDict</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="c1"># RTE_POSIX: &quot;RTE_POSIX&quot;,</span>
        <span class="c1"># RTE_WINDOWS: &quot;RTE_WINDOWS&quot;,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># : mapping of the rte numeric representation to the pretty string value</span>
<span class="c1"># num2pretty = {</span>
<span class="n">num2pretty</span> <span class="o">=</span> <span class="n">ProtectedDict</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">RTE_ARCHLINUX</span><span class="p">:</span> <span class="s1">&#39;Arch Linux&#39;</span><span class="p">,</span>
        <span class="n">RTE_BSD</span><span class="p">:</span> <span class="s2">&quot;Berkeley Software Distribution&quot;</span><span class="p">,</span>
        <span class="n">RTE_CENTOS</span><span class="p">:</span> <span class="s2">&quot;CentOS&quot;</span><span class="p">,</span>
        <span class="n">RTE_DARWIN</span><span class="p">:</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">,</span>
        <span class="n">RTE_DEBIAN</span><span class="p">:</span> <span class="s2">&quot;Debian&quot;</span><span class="p">,</span>
        <span class="n">RTE_FEDORA</span><span class="p">:</span> <span class="s2">&quot;Fedora&quot;</span><span class="p">,</span>
        <span class="n">RTE_LINUX</span><span class="p">:</span> <span class="s2">&quot;Linux&quot;</span><span class="p">,</span>
        <span class="n">RTE_NT</span><span class="p">:</span> <span class="s2">&quot;NT&quot;</span><span class="p">,</span>
        <span class="n">RTE_OPENBSD</span><span class="p">:</span> <span class="s2">&quot;OpenBSD&quot;</span><span class="p">,</span>
        <span class="n">RTE_WPEMU</span><span class="p">:</span> <span class="s2">&quot;Windows-Emulation&quot;</span><span class="p">,</span>
        <span class="n">RTE_POSIX</span><span class="p">:</span> <span class="s2">&quot;POSIX&quot;</span><span class="p">,</span>
        <span class="n">RTE_PWEMU</span><span class="p">:</span> <span class="s2">&quot;POSIX-Windows-Emulation&quot;</span><span class="p">,</span>
        <span class="n">RTE_RASPBIAN</span><span class="p">:</span> <span class="s2">&quot;Raspbian&quot;</span><span class="p">,</span>
        <span class="n">RTE_RHEL</span><span class="p">:</span> <span class="s2">&quot;RHEL&quot;</span><span class="p">,</span>
        <span class="n">RTE_UNIX</span><span class="p">:</span> <span class="s2">&quot;Unix&quot;</span><span class="p">,</span>
        <span class="n">RTE_WIN32</span><span class="p">:</span> <span class="s2">&quot;Windows&quot;</span><span class="p">,</span>
        <span class="n">RTE_WIN</span><span class="p">:</span> <span class="s2">&quot;Windows&quot;</span><span class="p">,</span>
        <span class="n">RTE_WINDOWS</span><span class="p">:</span> <span class="s2">&quot;Windows&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># : registered callbacks for special handling of custom layout</span>
<span class="n">custom_rte_distrel2tuple</span> <span class="o">=</span> <span class="n">ProtectedDict</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="c1"># e.g. RTE_MINIX3: minix.platformids.my_distrel2tuple,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># : dynamic registry for custom *category*</span>
<span class="n">custom_category</span> <span class="o">=</span> <span class="n">ProtectedDictEnum</span><span class="p">(</span>
    <span class="n">custom_min</span><span class="o">=</span><span class="mh">0x90000000</span><span class="p">,</span>
    <span class="n">custom_max</span><span class="o">=</span><span class="mh">0xf0000000</span><span class="p">,</span>
    <span class="n">custom_offset</span><span class="o">=</span><span class="mh">0x0fffffff</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># : dynamic registry for custom *ostype*</span>
<span class="n">custom_ostype</span> <span class="o">=</span> <span class="n">ProtectedDictEnum</span><span class="p">(</span>
    <span class="n">custom_min</span><span class="o">=</span><span class="mh">0x08000000</span><span class="p">,</span>
    <span class="n">custom_max</span><span class="o">=</span><span class="mh">0x0f800000</span><span class="p">,</span>
    <span class="n">custom_offset</span><span class="o">=</span><span class="mh">0x007fffff</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># : dynamic registry for custom *dist*</span>
<span class="n">custom_dist</span> <span class="o">=</span> <span class="n">ProtectedDictEnum</span><span class="p">(</span>
    <span class="n">custom_min</span><span class="o">=</span><span class="mh">0x00410000</span><span class="p">,</span>
    <span class="n">custom_max</span><span class="o">=</span><span class="mh">0x007f0000</span><span class="p">,</span>
    <span class="n">custom_offset</span><span class="o">=</span><span class="mh">0x0000ffff</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="get_modlocation"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.get_modlocation">[docs]</a><span class="k">def</span> <span class="nf">get_modlocation</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="n">mbase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mpaths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;   Calls the *pythonids.get_modulelocation* function with specific default parameters</span>
<span class="sd">    for the *platformids*. </span>
<span class="sd">     </span>
<span class="sd">    Args:</span>
<span class="sd">        mbase:</span>
<span class="sd">            Base for module search paths by default within the subdirectory of *platformids*.</span>
<span class="sd">            The filepath name with a trailing separator. ::</span>
<span class="sd">    </span>
<span class="sd">                default := os.path.dirname(__file__) + os.sep</span>
<span class="sd">    </span>
<span class="sd">            The base path is used within the post-processing of the eventually matched</span>
<span class="sd">            path, thus has to be appropriate for each item of *mpaths*. </span>
<span class="sd">    </span>
<span class="sd">        mname:</span>
<span class="sd">            The relative path of the module in dotted *Python* notation. ::</span>
<span class="sd">    </span>
<span class="sd">                mname := (</span>
<span class="sd">                     &lt;dotted-module-name-str&gt;</span>
<span class="sd">                   | &lt;dotted-module-name-path-name-str&gt;</span>
<span class="sd">                )</span>
<span class="sd">    </span>
<span class="sd">        mpaths:</span>
<span class="sd">            List of module specific search paths for *platformids*, these</span>
<span class="sd">            are relative to *mbase*, ::</span>
<span class="sd">    </span>
<span class="sd">                default := [</span>
<span class="sd">                   &#39;dist&#39;,</span>
<span class="sd">                   &#39;custom&#39;,</span>
<span class="sd">                   &#39;net&#39;,</span>
<span class="sd">                   &#39;embed&#39;,</span>
<span class="sd">                   &#39;&#39;,</span>
<span class="sd">                ]</span>

<span class="sd">            resulting in::</span>
<span class="sd">    </span>
<span class="sd">                default := [</span>
<span class="sd">                   mbase + &#39;dist&#39; + os.sep,</span>
<span class="sd">                   mbase + &#39;custom&#39; + os.sep,</span>
<span class="sd">                   mbase + &#39;net&#39; + os.sep,</span>
<span class="sd">                   mbase + &#39;embed&#39; + os.sep,</span>
<span class="sd">                   mbase,</span>
<span class="sd">                ]</span>
<span class="sd">    </span>
<span class="sd">        kargs:</span>
<span class="sd">            permitrel: </span>
<span class="sd">                Permit the return of relative module names within *mpath*.</span>
<span class="sd">                If *False* absolute only, which is relative to an existing</span>
<span class="sd">                *sys.path* entry. ::</span>
<span class="sd">                   </span>
<span class="sd">                    permitrel := (</span>
<span class="sd">                       True,       # returns a relative module name if within subtree</span>
<span class="sd">                       False       # returns in any case a module name relative to sys.path</span>
<span class="sd">                    )            </span>
<span class="sd">    </span>
<span class="sd">                Sets relative base within *platformids* as the default: ::</span>
<span class="sd">    </span>
<span class="sd">                    rbase = os.path.normpath(os.path.dirname(__file__)) + os.sep</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns in case of a match the resulting entry within *sys.modules*::</span>
<span class="sd">    </span>
<span class="sd">            match -&gt; (&lt;relative-module-name&gt;, &lt;module-file-path-name&gt;,)</span>
<span class="sd">       </span>
<span class="sd">        The default when no match occured is to rely on the more versatile</span>
<span class="sd">        search mechanism of the import implementation of the concrete </span>
<span class="sd">        *Python* implementation for another final trial by the caller::</span>
<span class="sd">    </span>
<span class="sd">            default -&gt; (&lt;mname&gt;, None,)</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>
<span class="sd">            &#39;mbase&#39; does not match &#39;mpaths&#39;</span>
<span class="sd">       </span>
<span class="sd">        PlatformIDsPresentError</span>
<span class="sd">            missing &#39;mbase&#39;</span>
<span class="sd">       </span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># not using sourceinfo package in order to avoid circular dependencies,</span>
    <span class="c1"># so keep platformids on lowest possible software-stack level</span>
    <span class="n">_permitrel</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;permitrel&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_permitrel</span><span class="p">:</span>
        <span class="n">rbase</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rbase&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rbase</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
        <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;rbase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rbase</span> 

    <span class="k">if</span> <span class="n">mbase</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">mbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">mbase</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>

    <span class="k">if</span> <span class="n">mpaths</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># default</span>
        <span class="n">mpaths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mbase</span> <span class="o">+</span> <span class="s1">&#39;dist&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
            <span class="n">mbase</span> <span class="o">+</span> <span class="s1">&#39;custom&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
            <span class="n">mbase</span> <span class="o">+</span> <span class="s1">&#39;net&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
            <span class="n">mbase</span> <span class="o">+</span> <span class="s1">&#39;embed&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span>
            <span class="n">mbase</span> <span class="p">,</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="n">mpaths</span> <span class="ow">and</span> <span class="n">mpaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c1"># permit relative to mbase only</span>
        <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mpaths</span><span class="p">)):</span>
            <span class="n">mpaths</span><span class="p">[</span><span class="n">mi</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">mbase</span> <span class="o">+</span> <span class="n">mpaths</span><span class="p">[</span><span class="n">mi</span><span class="p">])</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="n">mpaths</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PlatformIDsPresentError</span><span class="p">(</span><span class="s2">&quot;missing &#39;mpaths&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mpaths</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mpaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">mbase</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;mbase&#39; does not match &#39;mpaths&#39;</span><span class="se">\n</span><span class="s2">mbase = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">mpaths[0] = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span>
                <span class="n">mbase</span><span class="p">,</span> <span class="n">mpaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">get_modulelocation</span><span class="p">(</span><span class="n">mname</span><span class="p">,</span> <span class="n">mbase</span><span class="p">,</span> <span class="n">mpaths</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="decode_version_str_to_segments"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_version_str_to_segments">[docs]</a><span class="k">def</span> <span class="nf">decode_version_str_to_segments</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split a version string separated by &#39;.&#39; into an integer </span>
<span class="sd">    array. ::</span>
<span class="sd">       </span>
<span class="sd">        decode_version_str_to_segments(&#39;1.22.17&#39;)     =&gt;  (1, 22, 17)</span>
<span class="sd">        decode_version_str_to_segments(&#39;2012.02.17&#39;)  =&gt;  (2012, 2, 17)</span>
<span class="sd">        decode_version_str_to_segments(&#39;10.0.1809&#39;)   =&gt;  (10, 0, 1809)</span>
<span class="sd">    </span>
<span class="sd">    A tiny utility - frequently required.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        v: Version string with maximal 3 digits::</span>
<span class="sd">           </span>
<span class="sd">            (&#39;1.2.3&#39;)  =&gt;  (1, 2, 3)</span>
<span class="sd">            (&#39;1.2&#39;)    =&gt;  (1, 2, 0)</span>
<span class="sd">            (&#39;1&#39;)      =&gt;  (1, 0, 0)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of *int*. ::</span>
<span class="sd">          </span>
<span class="sd">            (&#39;1.2.3&#39;)  =&gt;  (1, 2, 3)</span>
<span class="sd">            (&#39;1.2&#39;)    =&gt;  (1, 2, 0)</span>
<span class="sd">            (&#39;1&#39;)      =&gt;  (1, 0, 0)</span>
<span class="sd">    </span>
<span class="sd">        In case an error occured::</span>
<span class="sd">    </span>
<span class="sd">            (0, 0, 0)</span>

<span class="sd">    Raises:</span>
<span class="sd">        None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># see manual</span>
    <span class="k">def</span> <span class="nf">tonum</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">raise</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">tonum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">VERSNUM</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">v</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]])</span></div>


<div class="viewcode-block" id="encode_rte_to_32bit"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.encode_rte_to_32bit">[docs]</a><span class="k">def</span> <span class="nf">encode_rte_to_32bit</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encodes the provided 32bit bitmask of each field into</span>
<span class="sd">    the combined integer value of the bitmask vector.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">       kargs:</span>
<span class="sd">            category:</span>
<span class="sd">                The numeric 32bit bitmask of the category: ::</span>
<span class="sd">             </span>
<span class="sd">                    category := (</span>
<span class="sd">                         &lt;int-enum&gt;</span>
<span class="sd">                       | &lt;category-key&gt;</span>
<span class="sd">                    )</span>
<span class="sd">                    int-enum:     the integer enum, preferbly a predefined value-by-var</span>
<span class="sd">                    category-key: the key value as string to be evaluated by one</span>
<span class="sd">    </span>
<span class="sd">                 of::</span>
<span class="sd">                 </span>
<span class="sd">                    *rte2num*:      the common mapping dictionary</span>
<span class="sd">                    *get_rte2num*:  the function interface for *rte2num*</span>
<span class="sd">             </span>
<span class="sd">                default is 0</span>
<span class="sd">    </span>
<span class="sd">            ostype:</span>
<span class="sd">                The numeric 32bit bitmask of the ostype::</span>
<span class="sd">             </span>
<span class="sd">                    ostype := (</span>
<span class="sd">                         &lt;int-enum&gt;</span>
<span class="sd">                       | &lt;ostype-key&gt;</span>
<span class="sd">                    )</span>
<span class="sd">                    int-enum:     the integer enum, preferbly a predefined value-by-var</span>
<span class="sd">                    ostype-key:   the key value as string to be evaluated by one</span>
<span class="sd">    </span>
<span class="sd">                of::</span>
<span class="sd">             </span>
<span class="sd">                    *rte2num*:      the common mapping dictionary</span>
<span class="sd">                    *get_rte2num*:  the function interface for *rte2num*</span>
<span class="sd">             </span>
<span class="sd">                default is 0.</span>
<span class="sd">          </span>
<span class="sd">            dist:</span>
<span class="sd">                The numeric 32bit bitmask of the dist::</span>
<span class="sd">          </span>
<span class="sd">                    ostype := (</span>
<span class="sd">                         &lt;int-enum&gt;</span>
<span class="sd">                       | &lt;dist-key&gt;</span>
<span class="sd">                    )</span>
<span class="sd">                    int-enum:     the integer enum, preferbly a predefined value-by-var</span>
<span class="sd">                    dist-key:     the key value as string to be evaluated by one</span>
<span class="sd">    </span>
<span class="sd">                of::</span>
<span class="sd">          </span>
<span class="sd">                    *rte2num*:      the common mapping dictionary</span>
<span class="sd">                    *get_rte2num*:  the function interface for *rte2num*</span>
<span class="sd">          </span>
<span class="sd">                default is 0.</span>
<span class="sd">          </span>
<span class="sd">            distrel:</span>
<span class="sd">                The numeric 32bit encoded integer for the distrel, default is 0.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        The 32bit compressed bitmask of the RTE.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">get_rte2num</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">|</span> <span class="n">get_rte2num</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ostype&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">|</span> <span class="n">get_rte2num</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">|</span> <span class="n">get_rte2num</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distrel&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="encode_rte_segments_to_32bit"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.encode_rte_segments_to_32bit">[docs]</a><span class="k">def</span> <span class="nf">encode_rte_segments_to_32bit</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts the numeric base values of the fields into a 32bit bitmask and</span>
<span class="sd">    encodes them into the combined integer value of the bitmask vector.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        kargs:</span>
<span class="sd">            category:</span>
<span class="sd">                The non-shifted base value of the category::</span>
<span class="sd">    </span>
<span class="sd">                    category := (</span>
<span class="sd">                         &lt;int-val&gt;</span>
<span class="sd">                    )</span>
<span class="sd">                    int-val:     the relative integer value of the category bits</span>
<span class="sd">    </span>
<span class="sd">                default is 0</span>
<span class="sd">    </span>
<span class="sd">            ostype:</span>
<span class="sd">                The non-shifted base value of the ostype::</span>
<span class="sd">    </span>
<span class="sd">                    ostype := (</span>
<span class="sd">                         &lt;int-val&gt;</span>
<span class="sd">                    )</span>
<span class="sd">                    int-val:     the relative integer value of the ostype bits</span>
<span class="sd">    </span>
<span class="sd">                default is 0.</span>
<span class="sd">    </span>
<span class="sd">            dist:</span>
<span class="sd">                The non-shifted base value of the dist::</span>
<span class="sd">    </span>
<span class="sd">                    dist := (</span>
<span class="sd">                         &lt;int-val&gt;</span>
<span class="sd">                    )</span>
<span class="sd">                    int-val:     the relative integer value of the dist bits</span>
<span class="sd">    </span>
<span class="sd">                default is 0.</span>
<span class="sd">    </span>
<span class="sd">            distrel:</span>
<span class="sd">                The non-shifted encoded base value of the distrel, default is 0.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        The 32bit compressed bitmask of the RTE.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span> <span class="o">|</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ostype&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">23</span> <span class="o">|</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distrel&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="fetch_platform_distribution"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_platform_distribution">[docs]</a><span class="k">def</span> <span class="nf">fetch_platform_distribution</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Scans the platform and returns the complete distribution data prepared for</span>
<span class="sd">    common post-processing.</span>
<span class="sd">     </span>
<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the information about the current distribution. ::</span>
<span class="sd">    </span>
<span class="sd">            result := (</span>
<span class="sd">               &lt;lowercase-dist-id&gt;,                 # 0: lower case str including release number</span>
<span class="sd">               &lt;dist-release-number-str&gt;,           # 1: the release number as string</span>
<span class="sd">               &lt;original-literal-release-name&gt;,     # 2: case sensitive release name</span>
<span class="sd">               &lt;original-literal-dist-name&gt;,        # 3: case sensitive distribution name</span>
<span class="sd">               &lt;dist-release-number-list&gt;,          # 4: release version as list of int</span>
<span class="sd">               &lt;lowercase-dist-&gt;,                   # 5: lower case str of dist name only</span>
<span class="sd">            )</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># provides a resulting canonical record, see manual</span>
    <span class="c1"># the most reliable and common code is to rely on the configuration files</span>

    <span class="c1"># 0: &lt;lowercase-dist-id&gt;,                 # lower case str</span>
    <span class="c1"># 1: &lt;dist-release-number-str&gt;,           # string</span>
    <span class="c1"># 2: &lt;original-literal-release-name&gt;,     # case sensitive str</span>
    <span class="c1"># 3: &lt;original-literal-dist-name&gt;,        # case sensitive str</span>
    <span class="c1"># 4: &lt;dist-release-number-list&gt;,          # list of int</span>
    <span class="c1"># 5: &lt;lowercase-dist-&gt;,                   # lower case str of dist name only</span>
    <span class="c1">#</span>

    <span class="k">if</span> <span class="n">category</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span> <span class="o">==</span> <span class="n">RTE_POSIX</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[]]</span>

        <span class="c1">#</span>
        <span class="c1"># a lot has to be evaluated by various extras - including some /etc/*</span>
        <span class="c1"># this is in particular the case for derived dist</span>
        <span class="c1">#</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/redhat-release&quot;</span><span class="p">):</span>
            <span class="c1"># rhel, centos, fedora, sc, oel, ...</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/etc/redhat-release&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># hopefully one only</span>
                    <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
                        <span class="n">dist</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?s)^([^0-9]*) release *([0-9.]*[^ ]*) [^(]*[(]([^)]*)[)][\n\t ]*$&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CentOS&#39;</span><span class="p">):</span>
                            <span class="kn">import</span> <span class="nn">platformids.dist.centos</span>
                            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">centos</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
                            
                        <span class="k">elif</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Red H&#39;</span><span class="p">):</span>
                            <span class="kn">import</span> <span class="nn">platformids.dist.rhel</span>
                            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">rhel</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
                        
                        <span class="k">elif</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Fedora&#39;</span><span class="p">):</span>
                            <span class="kn">import</span> <span class="nn">platformids.dist.fedora</span>
                            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Oracle&#39;</span><span class="p">):</span>
                            <span class="kn">import</span> <span class="nn">platformids.dist.oraclelinux</span>
                            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">oraclelinux</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[.-_]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/armbian-release&quot;</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">platformids.embed.armbian</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">embed</span><span class="o">.</span><span class="n">armbian</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/arch-release&quot;</span><span class="p">):</span>
            <span class="c1"># loads ArchLinux defines, a later stage loads an eventually derived distribution</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.archlinux</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">archlinux</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/alpine-release&quot;</span><span class="p">):</span>
            <span class="c1"># loads ArchLinux defines, a later stage loads an eventually derived distribution</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.alpinelinux</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">alpinelinux</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/gentoo-release&quot;</span><span class="p">):</span>
            <span class="c1"># loads ArchLinux defines, a later stage loads an eventually derived distribution</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.gentoo</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">gentoo</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/os-release&quot;</span><span class="p">):</span>
            <span class="c1"># debian, raspbian, etc.</span>
            <span class="c1"># openSUSE</span>
            <span class="c1"># sles???</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/debian_version&quot;</span><span class="p">):</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;debian&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Debian&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/etc/debian_version&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?s)^([0-9.]*).*$&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">dist</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

            <span class="n">_ver</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/etc/os-release&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ID=&#39;</span><span class="p">):</span>
                        <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">DSKORG_ID</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;VERSION=&#39;</span><span class="p">):</span>  <span class="c1"># priority though more widespread</span>
                        <span class="n">_ver</span> <span class="o">=</span> <span class="n">l</span>
                    <span class="k">elif</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;VERSION_ID=&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_ver</span><span class="p">:</span>  <span class="c1"># Ubuntu, redundant in Slackware</span>
                        <span class="n">_ver</span> <span class="o">=</span> <span class="n">l</span>
                    <span class="k">elif</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;NAME=&#39;</span><span class="p">):</span>
                        <span class="n">_nam</span> <span class="o">=</span> <span class="n">l</span>

            <span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;raspbian&#39;</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">platformids.embed.raspbian</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">embed</span><span class="o">.</span><span class="n">raspbian</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;kali&#39;</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">platformids.net.kali</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">kali</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/openwrt_release&quot;</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">platformids.net.openwrt</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">openwrt</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;debian&#39;</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">platformids.dist.debian</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">debian</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ubuntu&#39;</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">platformids.dist.ubuntu</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;opensuse&#39;</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">platformids.dist.opensuse</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">opensuse</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># loads module in second stage only by direct import</span>
                
                <span class="n">_l</span> <span class="o">=</span> <span class="n">DSKORG_RELEASE</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_ver</span><span class="p">)</span>
                <span class="n">dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[.]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;NAME=(.*)[\n]*&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">_nam</span><span class="p">)</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">_l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">_l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/pfSense-rc&#39;</span><span class="p">)):</span>
            <span class="kn">import</span> <span class="nn">platformids.net.pfsense</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">pfsense</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;openbsd&#39;</span><span class="p">)</span>  <span class="c1"># OpenBSD - CPython, PyPy, IPython</span>
                <span class="ow">or</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/bsd.booted&#39;</span><span class="p">)</span>  <span class="c1"># OpenBSD - match on Jython</span>
            <span class="p">):</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.openbsd</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">openbsd</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cygwin&#39;</span><span class="p">)</span>
                <span class="ow">or</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/cygdrive&#39;</span><span class="p">)</span>  <span class="c1"># rely on standard path only for now</span>
            <span class="p">):</span>
            <span class="c1"># Cygwin is a bit special as it mimics POSIX,</span>
            <span class="c1"># but runs the OS windows.</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.cygwin</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cygwin</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;freebsd&#39;</span><span class="p">)</span>  <span class="c1"># FreeBSD - CPython, PyPy, IPython</span>
                <span class="ow">or</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/freebsd-update.conf&#39;</span><span class="p">)</span>  <span class="c1"># FreeBSD - match on Jython</span>
            <span class="p">):</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.freebsd</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">freebsd</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;netbsd&#39;</span><span class="p">)</span>  <span class="c1"># NetBSD - CPython, PyPy, IPython</span>
                <span class="ow">or</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/netbsd-update.conf&#39;</span><span class="p">)</span>  <span class="c1"># NetBSD - match on Jython</span>
            <span class="p">):</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.netbsd</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">netbsd</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sunos5&#39;</span><span class="p">)</span>  <span class="c1"># Solaris10 + Solaris11 - CPython, PyPy, IPython</span>
                <span class="ow">or</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/release&#39;</span><span class="p">)</span>  <span class="c1"># Solaris10 + Solaris11 - match on Jython</span>
            <span class="p">):</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.solaris</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">solaris</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">)</span>  <span class="c1"># Solaris10 + Solaris11 - CPython, PyPy, IPython</span>
                <span class="ow">or</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/System/Library/Components/AppleScript.component&#39;</span><span class="p">)</span>  <span class="c1"># Solaris10 + Solaris11 - match on Jython</span>
            <span class="p">):</span>
            <span class="kn">import</span> <span class="nn">platformids.dist.darwin</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">platformids</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">darwin</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># default for unknown POSIX system</span>
                <span class="n">_u</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>  <span class="c1"># @UndefinedVariable</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([0-9.]*).*&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">_u</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                    <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([a-zA-Z-_]*).*&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">_u</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dist</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,)</span>

    <span class="k">elif</span> <span class="n">category</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span> <span class="o">==</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># windows support of NT-releases including Windows10IoT</span>
        <span class="c1">#</span>
        <span class="kn">from</span> <span class="nn">platformids.dist.windows</span> <span class="k">import</span> <span class="n">WinVersion</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">WinVersion</span><span class="p">()</span><span class="o">.</span><span class="n">readout_versioninfo_ext</span><span class="p">())</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span><span class="s2">&quot;Platform not supported: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">osname</span><span class="p">))</span></div>


<div class="viewcode-block" id="fetch_platform_distribution_num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_platform_distribution_num">[docs]</a><span class="k">def</span> <span class="nf">fetch_platform_distribution_num</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;The numeric version of &#39;fetch_platform_distribution&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the information about the current distribution. ::</span>
<span class="sd">    </span>
<span class="sd">          result := (</span>
<span class="sd">             #dist,                              # 0: distribution identifier</span>
<span class="sd">             #distrel,                           # 1: distribution release identifier</span>
<span class="sd">             #dist-release-number-list&gt;,         # 2: release version as list of int</span>
<span class="sd">          )</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># provides a resulting canonical record, see manual</span>
    <span class="c1">#</span>
    <span class="c1"># 0: &lt;category&gt;,                        # category</span>
    <span class="c1"># 1: &lt;ostype&gt;,                          # ostype</span>
    <span class="c1"># 2: &lt;dist&gt;,                            # dist</span>
    <span class="c1"># 3: &lt;distrel&gt;,                         # distrel</span>
    <span class="c1"># 4: &lt;hexversion&gt;,                      # hexversion of platform distribution release</span>
    <span class="c1"># 5: &lt;producttype&gt;,                     # producttype</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">fetch_category</span><span class="p">(),</span>
        <span class="n">fetch_ostype</span><span class="p">(),</span>
        <span class="n">fetch_dist</span><span class="p">(),</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">fetch_rte_hexversion</span><span class="p">(),</span>
        <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="fetch_platform_os"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_platform_os">[docs]</a><span class="k">def</span> <span class="nf">fetch_platform_os</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Scans the platform and returns the information on the OS including </span>
<span class="sd">    the name and the release version.</span>

<span class="sd">    The name of the OS is commonly basically the kernel name. The *ostype*</span>
<span class="sd">    of *linux* has one common kernel only, while OS in the *bsd* and</span>
<span class="sd">    *unix* family commonly have distribution specific customized kernels.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the information about the current os. ::</span>
<span class="sd">    </span>
<span class="sd">            res = (</span>
<span class="sd">               &lt;lowercase-os-id&gt;,            # osname: lower case str of os name</span>
<span class="sd">               &lt;os-release-number-str&gt;,      # osrel: string of os release version</span>
<span class="sd">               &lt;os-release-number-list&gt;,     # osrel: list of int of os release version</span>
<span class="sd">               &lt;lowercase-os-rel-id&gt;,        # osname+osrel: lower case str rel + id</span>
<span class="sd">            )</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">isJython</span><span class="p">:</span>
        <span class="c1"># Jython uname targets the JVM - need the actual underlying OS</span>
        <span class="n">on</span> <span class="o">=</span> <span class="n">PRENONNUM</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;os.name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>  <span class="c1"># @UndefinedVariable</span>
        <span class="n">ov</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;os.version&#39;</span><span class="p">))</span>  <span class="c1"># @UndefinedVariable</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">on</span><span class="p">,</span>
            <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ov</span><span class="p">,</span>
            <span class="n">ov</span><span class="p">,</span>
            <span class="n">on</span> <span class="o">+</span> <span class="s1">&#39;-</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ov</span>
            <span class="p">)</span>

    <span class="n">k</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">osname</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;BSD&#39;</span><span class="p">:</span>
            <span class="c1"># the kernel release is the same as the distrel</span>
            <span class="n">ov</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span><span class="p">(</span>
                <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">ov</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%s%d%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SunOS&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;5.10&#39;</span><span class="p">:</span>
                <span class="c1"># assume this release version more or less static for now</span>
                <span class="n">_patch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Generic_([0-9]*)-([0-9]*)&#39;</span><span class="p">)</span>  <span class="c1"># e.g. Generic_147148-26 -&gt; 14714826</span>
                <span class="n">_p</span> <span class="o">=</span> <span class="n">_patch</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\1\2&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">return</span><span class="p">(</span>
                    <span class="s1">&#39;sunos&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;5.10.0&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">_p</span><span class="p">)),</span>
                    <span class="s1">&#39;sunos5100&#39;</span>
                    <span class="p">)</span>

            <span class="k">elif</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;5.11&#39;</span><span class="p">:</span>
                <span class="c1"># for now - until 2021++??? - the future of Solaris remains nebulous and unsafe</span>
                <span class="n">ver</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">return</span><span class="p">(</span>
                    <span class="s1">&#39;sunos&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;5.&#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])),</span>
                    <span class="s1">&#39;sunos511&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                    <span class="p">)</span>

        <span class="n">ov</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">2</span><span class="p">],),</span>
            <span class="n">ov</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">%s%d%d%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">ov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">2</span><span class="p">],)</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="n">osname</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
            <span class="n">ov</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="s1">&#39;nt100&#39;</span><span class="p">,</span>
                <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">ov</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%s%d%d%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">2</span><span class="p">],)</span>
                <span class="p">)</span>

        <span class="n">ov</span> <span class="o">=</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">ov</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">%s%d%d%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ov</span><span class="p">[</span><span class="mi">2</span><span class="p">],)</span>
            <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Platform not supported: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">osname</span><span class="p">))</span></div>


<div class="viewcode-block" id="fetch_platform_os_num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_platform_os_num">[docs]</a><span class="k">def</span> <span class="nf">fetch_platform_os_num</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;The numeric version of &#39;`fetch_platform_os &lt;#fetch-platform-os&gt;`_&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the information about the current os. ::</span>
<span class="sd">    </span>
<span class="sd">            res = (</span>
<span class="sd">               &lt;enum-os-id&gt;,                 # osname: lower case str of os name</span>
<span class="sd">               &lt;32bit-os-release-number&gt;,    # osrel: string of os release version</span>
<span class="sd">               &lt;os-release-number-list&gt;,     # osrel: list of int of os release version</span>
<span class="sd">               &lt;enum-os-rel-id&gt;,             # osname+osrel: lower case str rel + id</span>
<span class="sd">            )</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># provides a resulting canonical record, see manual</span>
    <span class="c1">#</span>
    <span class="c1"># 0: &lt;numeric-dist-id&gt;,                 # lower case str</span>
    <span class="c1"># 1: &lt;dist-release-number-str&gt;,         # enum</span>
    <span class="c1"># 2: &lt;original-literal-release-name&gt;,   # case sensitive str</span>
    <span class="c1"># 3: &lt;numeric-dist&gt;,                    # enum</span>
    <span class="c1"># 4: &lt;dist-release-number-list&gt;,        # list of int</span>
    <span class="c1"># 5: &lt;numeric-dist-&gt;,                   # enum</span>
    <span class="c1">#</span>
    <span class="n">_r</span> <span class="o">=</span> <span class="n">fetch_platform_os</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">get_rte2num</span><span class="p">(</span><span class="n">_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">get_rte2num</span><span class="p">(</span><span class="n">_r</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">get_rte2num</span><span class="p">(</span><span class="n">_r</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>

    <span class="c1"># 0: &lt;lowercase-dist-id&gt;,                 # lower case str</span>
    <span class="c1"># 1: &lt;dist-release-number-str&gt;,           # string</span>
    <span class="c1"># 2: &lt;original-literal-release-name&gt;,     # case sensitive str</span>
    <span class="c1"># 3: &lt;original-literal-dist-name&gt;,        # case sensitive str</span>
    <span class="c1"># 4: &lt;dist-release-number-list&gt;,          # list of int</span>
    <span class="c1"># 5: &lt;lowercase-dist-&gt;,                   # lower case str of dist name only</span>

    <span class="p">)</span></div>


<div class="viewcode-block" id="fetch_category"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_category">[docs]</a><span class="k">def</span> <span class="nf">fetch_category</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Scans the platform and returns the numeric id for the current *category*.</span>

<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the *category*. ::</span>
<span class="sd">    </span>
<span class="sd">            res = &lt;category-bits&gt;&lt;ostype-bits-zero&gt;&lt;dist-bits-zero&gt;&lt;distrel-bits-zero&gt; </span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">osname</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Platform category not supported: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">osname</span><span class="p">))</span></div>


<div class="viewcode-block" id="fetch_ostype"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_ostype">[docs]</a><span class="k">def</span> <span class="nf">fetch_ostype</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Scans the platform and returns the numeric id for the current *ostype*.</span>

<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the *ostype* as integer enum. The bitmask includes </span>
<span class="sd">        the *category*. ::</span>
<span class="sd">    </span>
<span class="sd">            res = &lt;category-bits&gt;&lt;ostype-bits&gt;&lt;dist-bits-zero&gt;&lt;distrel-bits-zero&gt; </span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">osname</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">isJython</span><span class="p">:</span>
            <span class="c1"># _os = sys.getNativePlatform() # Available for 2.7.1+</span>
            <span class="c1"># _os = platform.System.getProperty(&#39;os.name&#39;).lower()  # @UndefinedVariable  # seems 2.0+</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">platform</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;os.name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span>  <span class="c1"># @UndefinedVariable</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">dist</span><span class="p">()</span> 
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;OS type not supported: </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> (platform.dist=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">osname</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RTE_POSIX</span> <span class="o">|</span> <span class="n">RTE_LINUX</span>

            <span class="k">elif</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;BSD&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RTE_POSIX</span> <span class="o">|</span> <span class="n">RTE_BSD</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># results on most supported OS for sys.platform:</span>
                    <span class="c1">#</span>
                    <span class="c1">#   correct as ostype, with minor fuzz</span>
                    <span class="c1">#      cygwin, darwin</span>
                    <span class="c1">#      linux, linux2</span>
                    <span class="c1">#      sunos5</span>
                    <span class="c1">#      win32</span>
                    <span class="c1">#</span>
                    <span class="c1">#   not exactly correct, these are distributions or almost distribution-releases</span>
                    <span class="c1">#      dragonfly5, freebsd11, netbsd8, openbsd6</span>
                    <span class="c1">#</span>
                    <span class="c1">#      minix3</span>
                    <span class="c1">#</span>
                    <span class="c1">#   some additional non-ostype</span>
                    <span class="c1">#      cli</span>
                    <span class="c1">#      java10.0.1, java11.0.2, java1.8.0_131, ... the jre/jdk - the world is encapsulated...</span>

                    <span class="c1">#</span>
                    <span class="c1"># SOLUTION: matches pre-registered and isolates ostype</span>
                    <span class="c1">#</span>
                    <span class="k">return</span>  <span class="n">rte2num</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span>

                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">dist</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;OS type not supported: </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> (platform.uname=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">osname</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>

    <span class="k">elif</span> <span class="n">osname</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RTE_WIN</span> <span class="o">|</span> <span class="n">RTE_NT</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># default pure dynamic by registration</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span>  <span class="c1"># @UndefinedVariable</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Platform not supported: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">osname</span><span class="p">))</span></div>


<div class="viewcode-block" id="fetch_dist"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_dist">[docs]</a><span class="k">def</span> <span class="nf">fetch_dist</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Scans the platform and returns the numeric id for the current *dist*.</span>

<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the *dist* as integer enum. The bitmask includes </span>
<span class="sd">        the *category* and *ostype*. ::</span>
<span class="sd">    </span>
<span class="sd">            res = &lt;category-bits&gt;&lt;ostype-bits&gt;&lt;dist-bits&gt;&lt;distrel-bits-zero&gt; </span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_d</span> <span class="o">=</span> <span class="n">fetch_platform_distribution</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">_d</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_rte2num</span><span class="p">(</span><span class="n">_d</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span></div>


<div class="viewcode-block" id="fetch_dist_tuple"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_dist_tuple">[docs]</a><span class="k">def</span> <span class="nf">fetch_dist_tuple</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Scans the platform and returns the complete tuple for the current *dist*.</span>

<span class="sd">    Args:</span>
<span class="sd">        none</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Returns the complete tuple of information related to a distribution. ::</span>
<span class="sd">    </span>
<span class="sd">            res = (&lt;distid-string&gt;, &lt;distrel-string&gt;, &lt;distrel-tuple&gt;, &lt;ditst-rel-key-string&gt;)</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_d</span> <span class="o">=</span> <span class="n">fetch_platform_distribution</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">_d</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
        <span class="n">_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">_d</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span></div>


<span class="c1">#</span>
<span class="c1"># first try the pre-scanned module offline created by setup.py</span>
<span class="c1">#</span>
<span class="n">_impmodname</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;setup_platform&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">_impmodname</span> <span class="o">=</span> <span class="n">f</span>

<span class="c1">#</span>
<span class="c1">#         if</span>
<span class="c1">#         for l in f:</span>
<span class="c1">#</span>
<span class="c1">#                     dist = re.split(r&#39;(?s)^([^0-9]*) release *([0-9.]*[^ ]*) [^(]*[(]([^)]*)[)][\n\t ]*$&#39;, l)</span>
<span class="c1">#                     dist.pop(0)</span>
<span class="c1">#                     dist[-1] = dist[0]</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1">#</span>
<span class="c1"># assign numeric value for current run time environment for dist(or windows)</span>
<span class="c1"># the resulting value bootstraps the load of the details of the release distrel</span>
<span class="c1"># exceptions:</span>
<span class="c1">#   some known are pre-loaded: windows</span>
<span class="c1">#   some known are hardcoded: see previous defines, e.g. some major Linux dists</span>
<span class="c1">#</span>
<span class="c1"># try to resolve the hierarchy as deep as possible</span>
<span class="c1"># it is basically the pre-load bootstrap, so the database is not reliable yet for non-standard</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="n">osname</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/redhat-release&quot;</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/os-release&quot;</span><span class="p">)</span>
        <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">RTE</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">fetch_platform_distribution</span><span class="p">()[</span><span class="mi">5</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rte2num</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># iterate for something seems to be known</span>
                <span class="c1"># ATTENTION: there are ambiguities, e.g. for debian derived</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                    <span class="n">RTE</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># for now we only know the category</span>
                <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_POSIX</span>

    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;openbsd&#39;</span><span class="p">):</span>
        <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_OPENBSD</span>

    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
        <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_DARWIN</span>

    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/openwrt_release&quot;</span><span class="p">):</span>
        <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_OPENWRT</span>

    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sunos5&#39;</span><span class="p">):</span>
<span class="c1">#        RTE = RTE_UNIX</span>
        <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_SOLARIS</span>

    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cygwin&#39;</span><span class="p">):</span>
        <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_PWEMU</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_POSIX</span>

<span class="k">elif</span> <span class="n">osname</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
    <span class="c1"># due to required special handling loads initially the complete windows set</span>
    <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_WIN32</span>

<span class="k">elif</span> <span class="n">osname</span> <span class="o">==</span> <span class="s1">&#39;java&#39;</span><span class="p">:</span>
    <span class="c1"># it is jython,</span>
    <span class="c1"># so have to pierce the encapsulation for getting the native platform parameters - want to do it in Python</span>

    <span class="n">RTE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_snp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getNativePlatform</span><span class="p">()</span>  <span class="c1"># @UndefinedVariable</span>
        <span class="n">RTE</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">_snp</span><span class="p">]</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">linux_distribution</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_LINUX</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/openwrt_release&quot;</span><span class="p">):</span>
                <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_OPENWRT</span>

            <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/redhat-release&quot;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/etc/os-release&quot;</span><span class="p">)</span>
                <span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">RTE</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">fetch_platform_distribution</span><span class="p">()[</span><span class="mi">5</span><span class="p">]]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rte2num</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">linux_distribution</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                            <span class="n">RTE</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_POSIX</span>

<span class="c1">#             elif sys.platform.startswith(&#39;openbsd&#39;):</span>
<span class="c1">#                 RTE = RTE_OPENBSD</span>
<span class="c1">#</span>
<span class="c1">#             elif sys.platform.startswith(&#39;sunos5&#39;):</span>
<span class="c1">#                 RTE = RTE_SOLARIS</span>
<span class="c1">#</span>
<span class="c1">#             elif sys.platform.startswith(&#39;darwin&#39;):</span>
<span class="c1">#                 RTE = RTE_DARWIN</span>
<span class="c1">#</span>
            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cygwin&#39;</span><span class="p">):</span>
                <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_PWEMU</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_POSIX</span>

        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">mac_ver</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_DARWIN</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">win32_ver</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">RTE</span> <span class="o">=</span> <span class="n">RTE_WIN32</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">RTE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span><span class="s2">&quot;Unknown platform: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_snp</span><span class="p">))</span>

<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Platform not supported&quot;</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># check setup dist exists, if not try dynamic evaluation</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">_impmodname</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_impmodname</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_impmodname</span> <span class="o">=</span> <span class="n">num2rte</span><span class="p">[</span><span class="n">RTE</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">RTE</span> <span class="o">==</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
            <span class="n">_impmodname</span> <span class="o">=</span> <span class="s1">&#39;windows&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span><span class="s2">&quot;not supported, requires:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num2rte</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1">#</span>
<span class="c1"># once the bootstrap module is selected load it</span>
<span class="c1"># loads the required module only for the current dist(or windows)</span>
<span class="c1">#</span>
<span class="n">modnamerel</span><span class="p">,</span> <span class="n">modfpath</span> <span class="o">=</span> <span class="n">get_modlocation</span><span class="p">(</span><span class="n">_impmodname</span><span class="p">)</span> 
<span class="k">if</span> <span class="n">modfpath</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

    <span class="c1"># system data - prohibit redefinition of present system data</span>
    <span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span> <span class="ow">or</span> <span class="p">(</span><span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_PWEMU</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTE_PWEMU</span><span class="p">:</span>
        <span class="n">mbase_altbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CommonProgramFiles&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;platformids&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mbase_altbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;etc&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;platformids&#39;</span>

    <span class="c1"># alternate data - prohibit redefinition of present data</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mbase_altbase</span><span class="p">):</span>
        <span class="n">mbase_altbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PLATFORMIDS_ALTBASE&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">mbase_altbase</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">modnamerel</span><span class="p">,</span> <span class="n">modfpath</span> <span class="o">=</span> <span class="n">get_modlocation</span><span class="p">(</span><span class="n">_impmodname</span><span class="p">,</span> <span class="n">mbase</span><span class="o">=</span><span class="n">mbase_altbase</span><span class="p">,</span> <span class="p">)</span>

    <span class="c1"># user data</span>
    <span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span> <span class="ow">or</span> <span class="p">(</span><span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_PWEMU</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTE_PWEMU</span><span class="p">:</span>
        <span class="n">mbase_altbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOCALAPPDATA&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;platformids&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mbase_altbase</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_LINUX</span><span class="p">:</span>
            <span class="n">mbase_altbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;.config&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;platformids&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mbase_altbase</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mbase_altbase</span><span class="p">):</span>
        <span class="n">mbase_altbase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;platformids&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># load module by file system path name</span>
    <span class="n">load_module</span><span class="p">(</span><span class="n">_impmodname</span><span class="p">,</span> <span class="n">modfpath</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="c1"># continue with generic</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="fetch_rte_hexversion"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.fetch_rte_hexversion">[docs]</a><span class="k">def</span> <span class="nf">fetch_rte_hexversion</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the bitmask encoding for current runtime environemnt.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        None.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        The encoded bitmask to be used for caching and *RTE*.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_pi</span> <span class="o">=</span> <span class="n">fetch_platform_distribution</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">_pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># here it is at least one defined as present</span>

    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># no mapping available,</span>

        <span class="c1"># try next &#39;nearest&#39; version to be expected compatible - for now cutting minor version numbers,</span>
        <span class="c1"># if not found step up the hierarchy &quot;category.ostype.dist.distrel&quot;</span>

        <span class="c1">#</span>
        <span class="c1"># TODO: adapt a better strategy, decrement major version - BUT for all platform version schemes!</span>
        <span class="c1">#</span>

        <span class="c1"># 1. try version steps</span>
        <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_pi</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">_k</span> <span class="o">=</span> <span class="n">_pi</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_pi</span><span class="p">[</span><span class="mi">4</span><span class="p">][:</span><span class="n">rx</span><span class="p">]))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>

            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># 2. try dist name</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">_pi</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>

            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># 3. try ostype</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">fetch_platform_os</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>

                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># 4. try category</span>

                        <span class="n">ret</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">fetch_platform_distribution</span><span class="p">()]</span>

                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>

                        <span class="n">ret</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">fetch_platform_os</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">ret</span></div>


<span class="c1">#</span>
<span class="c1"># here we have the *dist*, so now set the actual release of the distribution *distrel*, when present</span>
<span class="n">RTE</span> <span class="o">=</span> <span class="n">fetch_rte_hexversion</span><span class="p">()</span>

<span class="c1">#</span>
<span class="c1"># set: generic</span>
<span class="c1">#</span>

<span class="c1"># : Use the current block-offset only,</span>
<span class="c1"># : results in the current platformm enum.</span>
<span class="n">RTE_GENERIC</span> <span class="o">=</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span>

<span class="c1"># : Dyanmic local platform, synonym for generic.</span>
<span class="n">RTE_LOCAL</span> <span class="o">=</span> <span class="n">RTE_GENERIC</span> <span class="o">+</span> <span class="mi">1</span>


<div class="viewcode-block" id="decode_rte_category_to_num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_category_to_num">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_category_to_num</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed category from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding integer enum.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">            </span>
<span class="sd">            default := RTE</span>
<span class="sd">             </span>
<span class="sd">    Returns:</span>
<span class="sd">        Integer value of the category enum.</span>
<span class="sd">     </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">get_rte2num</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">RTE_CATEGORY</span><span class="p">)</span></div>


<div class="viewcode-block" id="decode_rte_ostype_to_num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_ostype_to_num">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_ostype_to_num</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed ostype from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding integer enum.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">            </span>
<span class="sd">            default := RTE</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Integer value of the ostype enum.</span>
<span class="sd">     </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">get_rte2num</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span><span class="p">)</span></div>


<div class="viewcode-block" id="decode_rte_dist_to_num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_dist_to_num">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_dist_to_num</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed dist from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding integer enum.</span>
<span class="sd">    Recognizes the *ostype* domain e.g. for *RTE_NT*.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">             </span>
<span class="sd">            default := RTE</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Integer value of the dist enum.</span>
<span class="sd">     </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">get_rte2num</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">)</span></div>


<div class="viewcode-block" id="decode_rte_distrel_to_num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_distrel_to_num">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_distrel_to_num</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed distrel from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding integer enum.</span>
<span class="sd">    Recognizes the *ostype* and *dist* domain, the distrel </span>
<span class="sd">    extension flag.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">             </span>
<span class="sd">            default := RTE</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Integer value of the encoded distrel.</span>
<span class="sd">     </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">get_rte2num</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">RTE_DISTREL</span><span class="p">)</span></div>


<div class="viewcode-block" id="decode_rte_distrel_to_segments"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_distrel_to_segments">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_distrel_to_segments</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed distrel from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding tuple of integer segments.</span>
<span class="sd">    </span>
<span class="sd">    This is probably one of the most important functions, because</span>
<span class="sd">    it has the knowledge to split *distrel* including calling</span>
<span class="sd">    a custom-callback function when required.</span>
<span class="sd">    Recognizes the *ostype* and *dist* domain, the *distrel* </span>
<span class="sd">    extension flag in order to determine the further processing.</span>
<span class="sd">    The supported special cases of known and pre-loaded standard</span>
<span class="sd">    distributions are hardcoded for better performance here,</span>
<span class="sd">    currently these are: ::</span>
<span class="sd">    </span>
<span class="sd">        ArchLinux, KaliLinux</span>
<span class="sd">        Windows-NT</span>
<span class="sd">        </span>
<span class="sd">        BlackArch, Gentoo, </span>
<span class="sd">        Armbian, ArchLinux, BlackArch, Gentoo, KaliLinux</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">             </span>
<span class="sd">            default := RTE</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of Integer values of the encoded segments, either</span>
<span class="sd">        as defined by the default layout, or any known as defined</span>
<span class="sd">        by additional extended and/or custom criteria.</span>
<span class="sd">     </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_rte</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">rte</span><span class="p">]</span>
        
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
            <span class="c1"># can split basically any number, let&#39;s see...</span>
            <span class="n">_rte</span> <span class="o">=</span> <span class="n">rte</span>

        <span class="k">elif</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">rte</span><span class="p">):</span>
            <span class="c1"># assume is a valid version string</span>
            <span class="k">return</span> <span class="n">decode_version_str_to_segments</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PlatformIDsUnknownError</span><span class="p">(</span><span class="s2">&quot;Not registered distrel = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rte</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span> <span class="o">==</span> <span class="n">RTE_NT</span><span class="p">:</span>
        <span class="c1"># known specials - Windows-NT</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">_rte</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span> <span class="o">==</span> <span class="n">RTE_LINUX</span> <span class="ow">and</span> <span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DISTEXT</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_KALI</span><span class="p">,</span> <span class="n">RTE_ARCHLINUX</span><span class="p">,):</span>
            <span class="c1"># known specials - date based rolling distros</span>
            <span class="c1"># fixed offset to 1970 - the UNIX-time</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="mh">0xfe00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1970</span><span class="p">,</span>
                <span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="mh">0x01e0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">,</span>
                <span class="n">_rte</span> <span class="o">&amp;</span> <span class="mh">0x001f</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span> <span class="ow">in</span> <span class="n">custom_rte_distrel2tuple</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># registered specials - call custom callback</span>
            <span class="k">return</span> <span class="n">custom_rte_distrel2tuple</span><span class="p">[</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">](</span><span class="n">rte</span><span class="p">)</span>

    <span class="c1"># default handler - see docu for &#39;3-number-default&#39;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="mh">0xfc00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">,</span>
        <span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="mh">0x03e0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">_rte</span> <span class="o">&amp;</span> <span class="mh">0x001f</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="decode_rte_to_segments"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_to_segments">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_to_segments</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed components from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding segments of relative integer values.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">             </span>
<span class="sd">            default := RTE</span>
<span class="sd">             </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of integer values of the components. ::</span>
<span class="sd">    </span>
<span class="sd">           ret := =&gt;  (#category-bits, #ostype-bits, #dist-bits, #distrel-bits)</span>
<span class="sd">    </span>
<span class="sd">        Where the following os true: ::</span>
<span class="sd">            </span>
<span class="sd">           rte == #category-bits &lt;&lt; 28 | #ostype-bits &lt;&lt; 23 | #dist-bits &lt;&lt; 16 | #distrel-bits</span>
<span class="sd">           rte == encode_rte_segments_to_32bit(#category-bits, #ostype-bits, #dist-bits, #distrel-bits)</span>
<span class="sd">           rte == encode_rte_segments_to_32bit( *decode_rte_to_segments( rte ) )</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rte</span> <span class="o">=</span> <span class="n">get_rte2num</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_CATEGORY_B</span><span class="p">),</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE_B</span><span class="p">),</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST_B</span><span class="p">),</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_DISTREL_B</span><span class="p">))</span></div>


<div class="viewcode-block" id="decode_rte_to_tuple"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_to_tuple">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_to_tuple</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed components from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding tuple of partial integer enums.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">             </span>
<span class="sd">            default := RTE</span>
<span class="sd">             </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of integer values of the components. ::</span>
<span class="sd">    </span>
<span class="sd">           ret := =&gt;  (#category-num, #ostype-num, #dist-num, #distrel-num)</span>
<span class="sd">    </span>
<span class="sd">        Where the following os true: ::</span>
<span class="sd">            </span>
<span class="sd">           ret == #category-num | #ostype-num | #dist-num | #distrel-num</span>
<span class="sd">           ret == #category-num + #ostype-num + #dist-num + #distrel-num</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rte</span> <span class="o">=</span> <span class="n">get_rte2num</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_CATEGORY</span><span class="p">),</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span><span class="p">),</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">),</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="n">RTE_DISTREL</span><span class="p">))</span></div>


<div class="viewcode-block" id="decode_rte_to_tuple_str"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.decode_rte_to_tuple_str">[docs]</a><span class="k">def</span> <span class="nf">decode_rte_to_tuple_str</span><span class="p">(</span><span class="n">rte</span><span class="o">=</span><span class="n">RTE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decodes the compressed components from the 32bit integer bitmask</span>
<span class="sd">    into the corresponding tuple of string keywords.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            The comppressed runtime environment identifier bitmask.</span>
<span class="sd">             </span>
<span class="sd">            default := RTE</span>
<span class="sd">             </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple of keywords of string values for the components. ::</span>
<span class="sd">    </span>
<span class="sd">           ret := =&gt;  (&lt;category&gt;, &lt;ostype&gt;, &lt;dist&gt;, &lt;distrel&gt;)</span>
<span class="sd">     </span>
<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_rte</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">rte</span><span class="p">]</span>  <span class="c1"># requires registered strings</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
                <span class="c1"># currently converting strings only if registered</span>
                <span class="k">raise</span>
            
            <span class="c1"># so is an numeric rte - seems at least to be</span>
            <span class="n">_rte</span> <span class="o">=</span> <span class="n">rte</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTE_NT</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_CATEGORY</span><span class="p">),</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span><span class="p">),</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">),</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DISTREL_B</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DISTEXT</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_CATEGORY</span><span class="p">),</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span><span class="p">),</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">),</span>
                <span class="n">get_num2rte</span><span class="p">(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DISTREL</span><span class="p">)</span>
                <span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># default handler - with expected table entries</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">num2rte</span><span class="p">[(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_CATEGORY</span><span class="p">)],</span>
                <span class="n">num2rte</span><span class="p">[(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_OSTYPE</span><span class="p">)],</span>
                <span class="n">num2rte</span><span class="p">[(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DIST</span><span class="p">)],</span>
                <span class="n">num2rte</span><span class="p">[(</span><span class="n">_rte</span> <span class="o">&amp;</span> <span class="n">RTE_DISTREL</span><span class="p">)]</span>
                <span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="get_num2rte"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.get_num2rte">[docs]</a><span class="k">def</span> <span class="nf">get_num2rte</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the corresponding string representation</span>
<span class="sd">    for the string numeric value.</span>
<span class="sd">     </span>
<span class="sd">    Alternatively the official dict *num2rte*</span>
<span class="sd">    could be used. </span>
<span class="sd">     </span>
<span class="sd">    Args:</span>
<span class="sd">        num:</span>
<span class="sd">            Numeric enum value of the requested platform.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        The string value, or *None**.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">num2rte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_rte2num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.get_rte2num">[docs]</a><span class="k">def</span> <span class="nf">get_rte2num</span><span class="p">(</span><span class="n">rte</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets corresponding numerical representation</span>
<span class="sd">    for the numeric or string value.</span>
<span class="sd">     </span>
<span class="sd">    Alternatively the official dict *rte2num*</span>
<span class="sd">    could be used. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        rte:</span>
<span class="sd">            Numeric enum value or string representation</span>
<span class="sd">            of the requested platform.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        The numeric value, or *None**.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISINT</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rte</span>

    <span class="c1">#</span>
    <span class="c1"># do not want to mix it up with platforms due to arising circular dependencies than</span>
    <span class="c1">#</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rte2num</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span>
            <span class="s2">&quot;TypeError: requires a valid key for &#39;platformids.rte2num&#39; (int, str)- got:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rte</span><span class="p">)))</span></div>


<div class="viewcode-block" id="set_num2rte"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.set_num2rte">[docs]</a><span class="k">def</span> <span class="nf">set_num2rte</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the numeric to string map.</span>
<span class="sd">    </span>
<span class="sd">    Alternatively the official dict *num2rte*</span>
<span class="sd">    could be used. </span>
<span class="sd">     </span>
<span class="sd">    Args:</span>
<span class="sd">        key:</span>
<span class="sd">            Numeric key value.</span>
<span class="sd">    </span>
<span class="sd">        value:</span>
<span class="sd">            String value.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        PlatformIDsError</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span><span class="s2">&quot;requires a int key, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span><span class="s2">&quot;requires a string value, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="n">num2rte</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="set_rte2num"><a class="viewcode-back" href="../../platformids.html#platformids.__init__.set_rte2num">[docs]</a><span class="k">def</span> <span class="nf">set_rte2num</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the rte to numeric mapping</span>

<span class="sd">    Alternatively the official dict *rte2num*</span>
<span class="sd">    could be used. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        key:</span>
<span class="sd">            Numeric or string key value.</span>
<span class="sd">    </span>
<span class="sd">        value:</span>
<span class="sd">            Numeric value.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PlatformIDsError</span><span class="p">(</span><span class="s2">&quot;requires an int value, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">rte2num</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<span class="c1"># 4debug</span>
<span class="k">pass</span>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Copyright (C) 2016 Arno-Can Uestuensoez @Ingenieurbuero Arno-Can Uestuensoez
      <span class="lastupdated">
        Last updated on Dec 18, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>